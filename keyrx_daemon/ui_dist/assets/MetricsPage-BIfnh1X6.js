import{y as e,r as s,j as t,z as a,L as l,F as n,D as i,Z as r,E as c,I as d,J as o,K as m,X as x,Y as h,M as g,O as p,V as j}from"./vendor-DchKSmaM.js";import{a as u,A as b,C as v}from"./client-DsuQMGGi.js";import{L as N}from"./LoadingSkeleton-DwR2jlpO.js";import{d as f}from"./useProfiles-MkTJ18U7.js";import"./index-DNY7ggn3.js";import"./schemas-DRbUxdzV.js";async function y(){return u.get("/api/metrics/latency")}async function w(){return u.get("/api/metrics/events")}const k=e((e,s)=>({latencyStats:null,eventLog:[],currentState:null,connected:!1,loading:!1,error:null,ws:null,fetchMetrics:async()=>{e({loading:!0,error:null});try{const[s,t]=await Promise.all([y(),w()]);e({latencyStats:s,eventLog:t,loading:!1})}catch(s){const t=s instanceof b?s.message:"Unknown error";e({error:t,loading:!1})}},subscribeToEvents:()=>{const{ws:t}=s();if(t&&t.readyState===WebSocket.OPEN)return;const a=`${"https:"===window.location.protocol?"wss:":"ws:"}//${window.location.host}/ws`,l=new WebSocket(a);l.onopen=()=>{e({connected:!0,error:null})},l.onmessage=t=>{try{const a=JSON.parse(t.data);switch(a.type){case"event":{const t=a.payload,{eventLog:l}=s(),n=[t,...l];n.length>1e3&&n.pop(),e({eventLog:n});break}case"state":{const s=a.payload;e({currentState:s});break}case"latency":{const s=a.payload;e({latencyStats:s});break}case"error":{const s=a.payload;e({error:s.message});break}}}catch(a){}},l.onerror=s=>{e({error:"WebSocket connection error",connected:!1})},l.onclose=()=>{e({connected:!1}),setTimeout(()=>{const{ws:e}=s();e&&e.readyState!==WebSocket.CLOSED||s().subscribeToEvents()},3e3)},e({ws:l})},unsubscribeFromEvents:()=>{const{ws:t}=s();t&&(t.close(),e({ws:null,connected:!1}))},clearEventLog:()=>{e({eventLog:[]})},clearError:()=>e({error:null})})),L=()=>{const{latencyStats:e,eventLog:u,currentState:b,connected:y,loading:w,error:L,subscribeToEvents:S,unsubscribeFromEvents:E}=k(),A=f(),[T,C]=s.useState([]);s.useEffect(()=>(S(),()=>E()),[S,E]),s.useEffect(()=>{e&&C(s=>[...s,{timestamp:Date.now(),latency:e.avg/1e3}].slice(-60))},[e]);const M=s.useMemo(()=>u.map(e=>({id:e.id,timestamp:new Date(e.timestamp).getTime(),type:"key_press"===e.type?"press":"key_release"===e.type?"release":e.type,keyCode:e.keyCode,action:e.action,latency:e.latencyUs/1e3})),[u]),D=s.useMemo(()=>b?{activeLayer:b.activeLayer,modifiers:b.modifiers,locks:b.locks,tapHoldTimers:b.tapHoldPending?1:0,queuedEvents:0}:{activeLayer:"Base",modifiers:[],locks:[],tapHoldTimers:0,queuedEvents:0},[b]),F=s.useMemo(()=>e?{current:e.avg/1e3,avg:e.avg/1e3,min:e.min/1e3,max:e.max/1e3}:{avg:0,min:0,max:0,current:0},[e]),$=e=>new Date(e).toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"}),P=e=>`${e.toFixed(2)}ms`;return w?t.jsxs("div",{className:"p-4 md:p-6 lg:p-8 space-y-4 md:space-y-6",children:[t.jsxs("div",{children:[t.jsx(N,{variant:"text",width:"250px",height:"32px"}),t.jsx(N,{variant:"text",width:"300px",height:"20px",className:"mt-2"})]}),t.jsx(v,{padding:"md",children:t.jsx(N,{variant:"rectangular",height:"60px"})}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-2 lg:grid-cols-4 gap-3 md:gap-4",children:[t.jsx(v,{padding:"md",children:t.jsx(N,{variant:"rectangular",height:"60px"})}),t.jsx(v,{padding:"md",children:t.jsx(N,{variant:"rectangular",height:"60px"})}),t.jsx(v,{padding:"md",children:t.jsx(N,{variant:"rectangular",height:"60px"})}),t.jsx(v,{padding:"md",children:t.jsx(N,{variant:"rectangular",height:"60px"})})]}),t.jsxs(v,{padding:"lg",children:[t.jsx(N,{variant:"text",width:"150px",height:"24px",className:"mb-4"}),t.jsx(N,{variant:"rectangular",height:"300px"})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6",children:[t.jsxs(v,{padding:"lg",children:[t.jsx(N,{variant:"text",width:"120px",height:"24px",className:"mb-4"}),t.jsx(N,{variant:"rectangular",height:"400px"})]}),t.jsxs(v,{padding:"lg",children:[t.jsx(N,{variant:"text",width:"140px",height:"24px",className:"mb-4"}),t.jsx(N,{variant:"rectangular",height:"400px"})]})]})]}):t.jsxs("main",{className:"p-4 md:p-6 lg:p-8 space-y-4 md:space-y-6",role:"main","aria-label":"Performance Metrics",children:[t.jsxs("header",{children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-xl md:text-2xl lg:text-3xl font-bold text-slate-100",children:"Performance Metrics"}),t.jsx("p",{className:"text-sm md:text-base text-slate-400 mt-2",children:"Real-time monitoring and debugging tools"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 rounded-full "+(y?"bg-green-500":"bg-red-500"),role:"status","aria-label":y?"Connected":"Disconnected"}),t.jsx("span",{className:"text-sm text-slate-400",children:y?"Live":"Disconnected"})]})]}),L&&t.jsx("div",{className:"mt-4 p-4 bg-red-500/10 border border-red-500/20 rounded-lg",children:t.jsx("p",{className:"text-sm text-red-400",children:L})})]}),t.jsx(v,{padding:"md","aria-label":"Active profile information",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-blue-500/10 rounded-lg",children:t.jsx(a,{className:"w-5 h-5 text-blue-500","aria-hidden":"true"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"text-sm text-slate-400",children:"Active Profile"}),A?t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(l,{to:`/config?profile=${encodeURIComponent(A.name)}`,className:"text-lg font-semibold text-blue-400 hover:text-blue-300 transition-colors underline","aria-label":`Edit ${A.name} configuration`,children:A.name}),t.jsx(n,{className:"w-4 h-4 text-slate-400","aria-hidden":"true"}),t.jsxs("span",{className:"text-sm text-slate-400 font-mono",children:[A.name,".rhai"]})]}),A.modifiedAt&&t.jsxs("p",{className:"text-xs text-slate-500",children:["Last modified: ",new Date(A.modifiedAt).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]}):t.jsxs("div",{className:"space-y-1",children:[t.jsx("p",{className:"text-lg font-semibold text-slate-400",children:y?"No active profile":"Daemon offline"}),y&&t.jsx(l,{to:"/profiles",className:"inline-block text-sm text-blue-400 hover:text-blue-300 transition-colors underline",children:"Activate a profile"})]})]})]})}),t.jsxs("section",{className:"grid grid-cols-2 md:grid-cols-2 lg:grid-cols-4 gap-3 md:gap-4","aria-label":"Latency statistics",children:[t.jsx(v,{padding:"md","aria-label":"Current latency",children:t.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-3",children:[t.jsx("div",{className:"p-2 sm:p-3 bg-blue-500/10 rounded-lg","aria-hidden":"true",children:t.jsx(a,{className:"w-5 h-5 sm:w-6 sm:h-6 text-blue-500"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs sm:text-sm text-slate-400",children:"Current"}),t.jsx("p",{className:"text-lg sm:text-2xl font-bold text-slate-100","aria-label":`Current latency: ${P(F.current)}`,children:P(F.current)})]})]})}),t.jsx(v,{padding:"md","aria-label":"Average latency",children:t.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-3",children:[t.jsx("div",{className:"p-2 sm:p-3 bg-green-500/10 rounded-lg","aria-hidden":"true",children:t.jsx(i,{className:"w-5 h-5 sm:w-6 sm:h-6 text-green-500"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs sm:text-sm text-slate-400",children:"Average"}),t.jsx("p",{className:"text-lg sm:text-2xl font-bold text-slate-100","aria-label":`Average latency: ${P(F.avg)}`,children:P(F.avg)})]})]})}),t.jsx(v,{padding:"md","aria-label":"Minimum latency",children:t.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-3",children:[t.jsx("div",{className:"p-2 sm:p-3 bg-yellow-500/10 rounded-lg",children:t.jsx(r,{className:"w-5 h-5 sm:w-6 sm:h-6 text-yellow-500"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs sm:text-sm text-slate-400",children:"Min"}),t.jsx("p",{className:"text-lg sm:text-2xl font-bold text-slate-100",children:P(F.min)})]})]})}),t.jsx(v,{padding:"md","aria-label":"Maximum latency",children:t.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-3",children:[t.jsx("div",{className:"p-2 sm:p-3 bg-red-500/10 rounded-lg",children:t.jsx(c,{className:"w-5 h-5 sm:w-6 sm:h-6 text-red-500"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs sm:text-sm text-slate-400",children:"Max"}),t.jsx("p",{className:"text-lg sm:text-2xl font-bold text-slate-100",children:P(F.max)})]})]})})]}),t.jsxs(v,{"aria-labelledby":"latency-chart-heading",children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("h2",{id:"latency-chart-heading",className:"text-lg md:text-xl font-semibold text-slate-100",children:"Latency Over Time"}),t.jsx("p",{className:"text-xs md:text-sm text-slate-400 mt-1",children:"Last 60 seconds"})]}),t.jsx(d,{width:"100%",height:250,className:"md:h-[300px]",children:t.jsxs(o,{data:T,children:[t.jsx(m,{strokeDasharray:"3 3",stroke:"#334155"}),t.jsx(x,{dataKey:"timestamp",tickFormatter:e=>new Date(e).toLocaleTimeString("en-US",{hour12:!1,minute:"2-digit",second:"2-digit"}),stroke:"#94A3B8",style:{fontSize:"12px"}}),t.jsx(h,{stroke:"#94A3B8",style:{fontSize:"12px"},label:{value:"Latency (ms)",angle:-90,position:"insideLeft",style:{fill:"#94A3B8",fontSize:"12px"}}}),t.jsx(g,{contentStyle:{backgroundColor:"#1E293B",border:"1px solid #334155",borderRadius:"8px",color:"#F1F5F9"},labelFormatter:e=>$(Number(e)),formatter:e=>[P(e),"Latency"]}),t.jsx(p,{type:"monotone",dataKey:"latency",stroke:"#3B82F6",strokeWidth:2,dot:!1,isAnimationActive:!1})]})})]}),t.jsxs(v,{"aria-labelledby":"event-log-heading",children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("h2",{id:"event-log-heading",className:"text-lg md:text-xl font-semibold text-slate-100",children:"Event Log"}),t.jsxs("p",{className:"text-xs md:text-sm text-slate-400 mt-1",children:["Recent keyboard events (",M.length," total)"]})]}),t.jsxs("div",{className:"hidden md:flex items-center gap-4 px-4 py-2 bg-slate-800 border-b border-slate-700 text-sm font-semibold text-slate-300",children:[t.jsx("span",{className:"w-32",children:"Timestamp"}),t.jsx("span",{className:"w-24",children:"Type"}),t.jsx("span",{className:"w-32",children:"Key Code"}),t.jsx("span",{className:"w-32",children:"Action"}),t.jsx("span",{className:"w-20",children:"Latency"})]}),t.jsx(j,{height:300,itemCount:M.length,itemSize:40,width:"100%",className:"bg-slate-900",children:({index:e,style:s})=>{const a=M[e];return a?t.jsxs("div",{style:s,className:"flex items-center gap-4 px-4 text-sm font-mono border-b border-slate-700 hover:bg-slate-700/50",children:[t.jsx("span",{className:"w-32 text-slate-400",children:$(a.timestamp)}),t.jsx("span",{className:`w-24 ${{press:"text-green-400",release:"text-red-400",tap:"text-blue-400",hold:"text-yellow-400",macro:"text-purple-400",layer_switch:"text-cyan-400"}[a.type]}`,children:a.type}),t.jsx("span",{className:"w-32 text-slate-200",children:a.keyCode}),a.action&&t.jsxs("span",{className:"w-32 text-slate-300",children:["â†’ ",a.action]}),t.jsx("span",{className:"w-20 text-slate-400",children:P(a.latency)})]}):null}})]}),t.jsxs(v,{"aria-labelledby":"state-inspector-heading",children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("h2",{id:"state-inspector-heading",className:"text-lg md:text-xl font-semibold text-slate-100",children:"State Inspector"}),t.jsx("p",{className:"text-xs md:text-sm text-slate-400 mt-1",children:"Current daemon internal state"})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-4",children:[t.jsxs("div",{className:"bg-slate-800 rounded-lg p-4",children:[t.jsx("h3",{className:"text-sm font-semibold text-slate-300 mb-2",children:"Active Layer"}),t.jsx("p",{className:"text-lg font-mono text-blue-400",children:D.activeLayer})]}),t.jsxs("div",{className:"bg-slate-800 rounded-lg p-4",children:[t.jsx("h3",{className:"text-sm font-semibold text-slate-300 mb-2",children:"Tap/Hold Timers"}),t.jsxs("p",{className:"text-lg font-mono text-yellow-400",children:[D.tapHoldTimers," active"]})]}),t.jsxs("div",{className:"bg-slate-800 rounded-lg p-4",children:[t.jsx("h3",{className:"text-sm font-semibold text-slate-300 mb-2",children:"Active Modifiers"}),t.jsx("p",{className:"text-lg font-mono text-green-400",children:D.modifiers.length>0?D.modifiers.join(", "):"None"})]}),t.jsxs("div",{className:"bg-slate-800 rounded-lg p-4",children:[t.jsx("h3",{className:"text-sm font-semibold text-slate-300 mb-2",children:"Active Locks"}),t.jsx("p",{className:"text-lg font-mono text-purple-400",children:D.locks.length>0?D.locks.join(", "):"None"})]}),t.jsxs("div",{className:"bg-slate-800 rounded-lg p-4",children:[t.jsx("h3",{className:"text-sm font-semibold text-slate-300 mb-2",children:"Queued Events"}),t.jsx("p",{className:"text-lg font-mono text-red-400",children:D.queuedEvents})]})]})]})]})};export{L as MetricsPage,L as default};
//# sourceMappingURL=MetricsPage-BIfnh1X6.js.map
