{"version":3,"mappings":"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","names":["state","className","children","jsxs","jsx","modifiers","map","modId","locks","length","lockId","layer","WasmContext","createContext","WasmProvider","isWasmReady","setIsWasmReady","useState","setError","wasmModule","setWasmModule","useEffect","async","performance","now","setIsLoading","module","__vitePreload","import","__VITE_PRELOAD__","catch","Error","wasm_init","err","errorMessage","message","String","validateConfig","useCallback","load_config","code","lineMatch","match","columnMatch","line","parseInt","column","runSimulation","configHandle","inputJson","stringify","input","simulate","isLoading","error","Provider","value","MonacoEditor","onChange","onValidate","readOnly","height","useRef","monacoRef","errors","setErrors","validationStatus","setValidationStatus","context","useContext","useWasmContext","jumpToNextError","editorRef","current","nextIndex","setCurrentErrorIndex","lineNumber","setPosition","position","revealPositionInCenter","focus","currentErrorIndex","validationErrors","getModel","model","markers","severity","MarkerSeverity","startLineNumber","startColumn","endLineNumber","endColumn","editor","setModelMarkers","newValue","clearTimeout","validationTimeoutRef","setTimeout","runValidation","startsWith","defaultLanguage","beforeMount","monaco","languages","register","setMonarchTokensProvider","keywords","operators","symbols","escapes","tokenizer","root","cases","include","whitespace","comment","string_double","string_single","defineTheme","base","inherit","rules","token","foreground","fontStyle","colors","onMount","updateOptions","minimap","fontSize","tabSize","rulers","automaticLayout","scrollBeyondLastLine","wordWrap","addCommand","KeyCode","F8","options","SimulatorPage","pressedKeys","Set","events","setEvents","setState","activeLayer","ctrl","shift","alt","gui","capsLock","numLock","scrollLock","setIsPaused","holdTimers","setHoldTimers","Map","autoPauseTimerRef","Date","isLoadingProfiles","useProfiles","data","isLoadingConfig","selectedProfile","isLoadingWasm","initWasm","JSON","useWasm","configLoadError","setConfigLoadError","isUsingProfileConfig","setWasmState","customCode","setCustomCode","profiles","setSelectedProfile","name","profileConfig","setIsUsingProfileConfig","source","e","join","errorMsg","loadProfileConfig","keyMappings","type","tapAction","holdAction","threshold","timestamp","toLocaleTimeString","hour12","slice","handleKeyPress","keyCode","isPaused","setPressedKeys","prev","add","key","keycode","event_type","timestamp_us","result","final_state","active_modifiers","toString","padStart","active_locks","active_layer","outputs","forEach","output","addEvent","includes","mapping","get","timerId","window","set","handleKeyRelease","lastActivityRef","next","delete","handleKeyClick","has","handleReset","padEnd","navigator","clipboard","writeText","logText","setInterval","clearInterval","Button","variant","size","onClick","disabled","Card","setUseCustomCode","setValidationErrors","htmlFor","id","target","profile","isActive","xmlns","fill","viewBox","cx","cy","stroke","strokeWidth","role","StateIndicatorPanel","wasmState","entries","active","charAt","toUpperCase","replace","trim","split","w","Math","min","index","event","KeyboardVisualizer","layout","onKeyClick","simulatorMode","SimulatorPageWithWasm"],"ignoreList":[],"sources":["../../src/components/StateIndicatorPanel.tsx","../../src/contexts/WasmContext.tsx","../../src/components/MonacoEditor.tsx","../../src/pages/SimulatorPage.tsx","../../src/hooks/useWasm.ts"],"sourcesContent":["/**\n * StateIndicatorPanel - Visual display of daemon state\n *\n * Displays the current daemon state including active modifiers, locks, and layer\n * with color-coded badges (blue for modifiers, orange for locks, green for layer).\n */\n\nimport React from 'react';\nimport type { DaemonState } from '../types/rpc';\n\ninterface StateIndicatorPanelProps {\n  state: DaemonState | null;\n}\n\n/**\n * StateIndicatorPanel component - Displays daemon state with color-coded badges\n *\n * @param state - Current daemon state (null while loading)\n * @returns Visual panel with modifiers (blue), locks (orange), and layer (green)\n */\nexport function StateIndicatorPanel({ state }: StateIndicatorPanelProps) {\n  if (!state) {\n    return (\n      <div className=\"p-4 bg-slate-800 rounded-lg\">\n        <p className=\"text-slate-400 text-sm\">Loading daemon state...</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-4 bg-slate-800 rounded-lg\">\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        {/* Modifiers Section */}\n        <div>\n          <h3 className=\"text-sm font-medium text-slate-300 mb-2\" aria-label=\"Active Modifiers\">\n            Modifiers\n          </h3>\n          <div className=\"flex flex-wrap gap-2\">\n            {state.modifiers && state.modifiers.length > 0 ? (\n              state.modifiers.map((modId) => (\n                <span\n                  key={`mod-${modId}`}\n                  className=\"px-3 py-1 bg-blue-600 text-white text-sm rounded-full font-medium\"\n                  aria-label={`Modifier ${modId} active`}\n                >\n                  MOD_{modId}\n                </span>\n              ))\n            ) : (\n              <span className=\"text-slate-500 text-sm\" aria-label=\"No modifiers active\">\n                None\n              </span>\n            )}\n          </div>\n        </div>\n\n        {/* Locks Section */}\n        <div>\n          <h3 className=\"text-sm font-medium text-slate-300 mb-2\" aria-label=\"Active Locks\">\n            Locks\n          </h3>\n          <div className=\"flex flex-wrap gap-2\">\n            {state.locks && state.locks.length > 0 ? (\n              state.locks.map((lockId) => (\n                <span\n                  key={`lock-${lockId}`}\n                  className=\"px-3 py-1 bg-orange-600 text-white text-sm rounded-full font-medium\"\n                  aria-label={`Lock ${lockId} active`}\n                >\n                  LOCK_{lockId}\n                </span>\n              ))\n            ) : (\n              <span className=\"text-slate-500 text-sm\" aria-label=\"No locks active\">\n                None\n              </span>\n            )}\n          </div>\n        </div>\n\n        {/* Layer Section */}\n        <div>\n          <h3 className=\"text-sm font-medium text-slate-300 mb-2\" aria-label=\"Current Layer\">\n            Layer\n          </h3>\n          <div className=\"flex flex-wrap gap-2\">\n            <span\n              className=\"px-3 py-1 bg-green-600 text-white text-sm rounded-full font-medium\"\n              aria-label={`Layer ${state.layer} active`}\n            >\n              Layer {state.layer}\n            </span>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","import React, { createContext, useContext, useEffect, useState, useCallback } from 'react';\nimport type { ValidationError, SimulationResult, SimulationInput } from '../hooks/useWasm';\n\n// Type definitions for WASM module\ninterface WasmModule {\n  wasm_init: () => void;\n  load_config: (source: string) => number; // Returns ConfigHandle\n  simulate: (configHandle: number, eventsJson: string) => unknown;\n}\n\ninterface WasmContextValue {\n  isWasmReady: boolean;\n  isLoading: boolean;\n  error: Error | null;\n  validateConfig: (code: string) => Promise<ValidationError[]>;\n  runSimulation: (code: string, input: SimulationInput) => Promise<SimulationResult | null>;\n}\n\nconst WasmContext = createContext<WasmContextValue | null>(null);\n\n/**\n * Global WASM Provider - initializes WASM once at app startup\n * Prevents re-initialization on page navigation\n */\nexport function WasmProvider({ children }: { children: React.ReactNode }) {\n  const [isWasmReady, setIsWasmReady] = useState(false);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState<Error | null>(null);\n  const [wasmModule, setWasmModule] = useState<WasmModule | null>(null);\n\n  useEffect(() => {\n    // Initialize WASM module ONCE for entire app lifecycle\n    async function initWasm() {\n      const startTime = performance.now();\n      console.info('[WASM] Starting global initialization...');\n      setIsLoading(true);\n\n      try {\n        console.info('[WASM] Fetching module...');\n        const module = await import('@/wasm/pkg/keyrx_core.js').catch(() => {\n          throw new Error('WASM module not found. Run build:wasm to compile the WASM module.');\n        });\n\n        console.info('[WASM] Module loaded, initializing...');\n        module.wasm_init();\n\n        const loadTime = performance.now() - startTime;\n        setWasmModule(module as unknown as WasmModule);\n        setIsWasmReady(true);\n        setIsLoading(false);\n        console.info(`[WASM] ✓ Global initialization complete in ${loadTime.toFixed(0)}ms`);\n      } catch (err) {\n        const errorMessage = err instanceof Error ? err.message : String(err);\n        const loadTime = performance.now() - startTime;\n        console.warn(`[WASM] Initialization failed after ${loadTime.toFixed(0)}ms:`, errorMessage);\n        setError(err instanceof Error ? err : new Error(errorMessage));\n        setIsWasmReady(false);\n        setIsLoading(false);\n      }\n    }\n\n    initWasm();\n  }, []); // Empty deps = initialize once on app mount\n\n  const validateConfig = useCallback(\n    async (code: string): Promise<ValidationError[]> => {\n      if (!isWasmReady || !wasmModule) {\n        console.debug('WASM not ready, skipping validation');\n        return [];\n      }\n\n      try {\n        wasmModule.load_config(code);\n        return [];\n      } catch (err) {\n        const errorMessage = err instanceof Error ? err.message : String(err);\n        console.debug('Validation error:', errorMessage);\n\n        const lineMatch = errorMessage.match(/line (\\d+)/i);\n        const columnMatch = errorMessage.match(/column (\\d+)/i);\n\n        const line = lineMatch ? parseInt(lineMatch[1], 10) : 1;\n        const column = columnMatch ? parseInt(columnMatch[1], 10) : 1;\n\n        return [\n          {\n            line,\n            column,\n            length: 1,\n            message: errorMessage,\n          },\n        ];\n      }\n    },\n    [isWasmReady, wasmModule]\n  );\n\n  const runSimulation = useCallback(\n    async (code: string, input: SimulationInput): Promise<SimulationResult | null> => {\n      if (!isWasmReady || !wasmModule) {\n        console.debug('WASM not ready, skipping simulation');\n        return null;\n      }\n\n      try {\n        const configHandle = wasmModule.load_config(code);\n        const inputJson = JSON.stringify(input);\n        const result = wasmModule.simulate(configHandle, inputJson);\n        return result as SimulationResult;\n      } catch (err) {\n        const errorMessage = err instanceof Error ? err.message : String(err);\n        console.error('Simulation error:', errorMessage);\n        return null;\n      }\n    },\n    [isWasmReady, wasmModule]\n  );\n\n  const value: WasmContextValue = {\n    isWasmReady,\n    isLoading,\n    error,\n    validateConfig,\n    runSimulation,\n  };\n\n  return <WasmContext.Provider value={value}>{children}</WasmContext.Provider>;\n}\n\n/**\n * Hook to access WASM context\n * Use this instead of useWasm() for cached WASM access\n */\nexport function useWasmContext() {\n  const context = useContext(WasmContext);\n  if (!context) {\n    throw new Error('useWasmContext must be used within WasmProvider');\n  }\n  return context;\n}\n","import { Editor, BeforeMount, OnMount } from '@monaco-editor/react';\nimport { useCallback, useEffect, useRef, useState } from 'react';\nimport type { editor } from 'monaco-editor';\nimport type { ValidationError } from '../hooks/useWasm';\nimport { useWasmContext } from '../contexts/WasmContext';\n\n/**\n * Monaco Editor component for Rhai configuration editing\n *\n * Features:\n * - Rhai syntax highlighting with custom language definition\n * - F8 keybinding for next error navigation\n * - 500ms debounced validation\n * - Error markers with tooltips\n * - Dark theme optimized for Rhai\n */\n\ninterface MonacoEditorProps {\n  value: string;\n  onChange?: (value: string) => void;\n  onValidate?: (errors: ValidationError[]) => void;\n  readOnly?: boolean;\n  height?: string;\n}\n\nexport function MonacoEditor({\n  value,\n  onChange,\n  onValidate,\n  readOnly = false,\n  height = '600px',\n}: MonacoEditorProps) {\n  const editorRef = useRef<editor.IStandaloneCodeEditor | null>(null);\n  const monacoRef = useRef<typeof import('monaco-editor') | null>(null);\n  const validationTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const [currentErrorIndex, setCurrentErrorIndex] = useState(0);\n  const [errors, setErrors] = useState<ValidationError[]>([]);\n  const [validationStatus, setValidationStatus] = useState<string>('Initializing...');\n\n  const { isWasmReady, isLoading, validateConfig } = useWasmContext();\n\n  // Update status when WASM loading state changes\n  useEffect(() => {\n    if (isLoading) {\n      setValidationStatus('⏳ Loading WASM validator...');\n    } else if (isWasmReady) {\n      setValidationStatus('✓ Ready');\n    } else {\n      setValidationStatus('⚠ WASM unavailable');\n    }\n  }, [isLoading, isWasmReady]);\n\n  /**\n   * Register Rhai language with Monaco before editor mounts\n   */\n  const handleBeforeMount: BeforeMount = (monaco) => {\n    monacoRef.current = monaco;\n\n    // Register Rhai language\n    monaco.languages.register({ id: 'rhai' });\n\n    // Define Rhai syntax highlighting rules using Monarch tokenizer\n    monaco.languages.setMonarchTokensProvider('rhai', {\n      keywords: [\n        'let', 'const', 'if', 'else', 'while', 'for', 'loop',\n        'break', 'continue', 'return', 'fn', 'true', 'false',\n        'import', 'export', 'as', 'private', 'this', 'in',\n      ],\n      operators: [\n        '=', '>', '<', '!', '~', '?', ':', '==', '<=', '>=', '!=',\n        '&&', '||', '++', '--', '+', '-', '*', '/', '&', '|', '^',\n        '%', '<<', '>>', '>>>', '+=', '-=', '*=', '/=', '&=', '|=',\n        '^=', '%=', '<<=', '>>=', '>>>=', '=>',\n      ],\n      symbols: /[=><!~?:&|+\\-*/^%]+/,\n      escapes: /\\\\(?:[abfnrtv\\\\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,\n\n      tokenizer: {\n        root: [\n          // Identifiers and keywords\n          [/[a-zA-Z_]\\w*/, {\n            cases: {\n              '@keywords': 'keyword',\n              '@default': 'identifier',\n            },\n          }],\n\n          // Whitespace\n          { include: '@whitespace' },\n\n          // Delimiters and operators\n          [/[{}()[\\]]/, '@brackets'],\n          [/[<>](?!@symbols)/, '@brackets'],\n          [/@symbols/, {\n            cases: {\n              '@operators': 'operator',\n              '@default': '',\n            },\n          }],\n\n          // Numbers\n          [/\\d*\\.\\d+([eE][-+]?\\d+)?/, 'number.float'],\n          [/0[xX][0-9a-fA-F]+/, 'number.hex'],\n          [/\\d+/, 'number'],\n\n          // Strings\n          [/\"([^\"\\\\]|\\\\.)*$/, 'string.invalid'],\n          [/\"/, 'string', '@string_double'],\n          [/'([^'\\\\]|\\\\.)*$/, 'string.invalid'],\n          [/'/, 'string', '@string_single'],\n        ],\n\n        whitespace: [\n          [/[ \\t\\r\\n]+/, ''],\n          [/\\/\\*/, 'comment', '@comment'],\n          [/\\/\\/.*$/, 'comment'],\n        ],\n\n        comment: [\n          [/[^/*]+/, 'comment'],\n          [/\\*\\//, 'comment', '@pop'],\n          [/[/*]/, 'comment'],\n        ],\n\n        string_double: [\n          [/[^\\\\\"]+/, 'string'],\n          [/@escapes/, 'string.escape'],\n          [/\\\\./, 'string.escape.invalid'],\n          [/\"/, 'string', '@pop'],\n        ],\n\n        string_single: [\n          [/[^\\\\']+/, 'string'],\n          [/@escapes/, 'string.escape'],\n          [/\\\\./, 'string.escape.invalid'],\n          [/'/, 'string', '@pop'],\n        ],\n      },\n    });\n\n    // Define rhai-dark theme\n    monaco.editor.defineTheme('rhai-dark', {\n      base: 'vs-dark',\n      inherit: true,\n      rules: [\n        { token: 'keyword', foreground: 'C586C0', fontStyle: 'bold' },\n        { token: 'identifier', foreground: '9CDCFE' },\n        { token: 'operator', foreground: 'D4D4D4' },\n        { token: 'number', foreground: 'B5CEA8' },\n        { token: 'number.float', foreground: 'B5CEA8' },\n        { token: 'number.hex', foreground: 'B5CEA8' },\n        { token: 'string', foreground: 'CE9178' },\n        { token: 'comment', foreground: '6A9955', fontStyle: 'italic' },\n      ],\n      colors: {\n        'editor.background': '#1e1e1e',\n        'editor.foreground': '#d4d4d4',\n        'editorLineNumber.foreground': '#858585',\n        'editor.selectionBackground': '#264f78',\n        'editor.inactiveSelectionBackground': '#3a3d41',\n      },\n    });\n  };\n\n  /**\n   * Configure editor after mount\n   */\n  const handleMount: OnMount = (editor, monaco) => {\n    editorRef.current = editor;\n    monacoRef.current = monaco;\n\n    // Configure editor options\n    editor.updateOptions({\n      minimap: { enabled: false },\n      fontSize: 14,\n      tabSize: 2,\n      rulers: [80, 120],\n      automaticLayout: true,\n      scrollBeyondLastLine: false,\n      wordWrap: 'on',\n    });\n\n    // Add F8 keybinding for next error navigation\n    editor.addCommand(monaco.KeyCode.F8, () => {\n      jumpToNextError();\n    });\n  };\n\n  /**\n   * Jump to next error and center the line\n   */\n  const jumpToNextError = useCallback(() => {\n    if (!editorRef.current || !monacoRef.current || errors.length === 0) {\n      return;\n    }\n\n    const nextIndex = (currentErrorIndex + 1) % errors.length;\n    setCurrentErrorIndex(nextIndex);\n\n    const error = errors[nextIndex];\n    const position = {\n      lineNumber: error.line,\n      column: error.column,\n    };\n\n    // Jump to error position and center the line\n    editorRef.current.setPosition(position);\n    editorRef.current.revealPositionInCenter(position);\n\n    // Focus on the editor\n    editorRef.current.focus();\n  }, [errors, currentErrorIndex]);\n\n  /**\n   * Run validation with debouncing\n   */\n  const runValidation = useCallback(\n    async (code: string) => {\n      if (!isWasmReady) {\n        setValidationStatus('WASM validation unavailable');\n        return;\n      }\n\n      setValidationStatus('Validating...');\n\n      try {\n        const validationErrors = await validateConfig(code);\n        setErrors(validationErrors);\n        setCurrentErrorIndex(0);\n\n        if (validationErrors.length === 0) {\n          setValidationStatus('✓ No errors');\n        } else {\n          setValidationStatus(`✗ ${validationErrors.length} error${validationErrors.length > 1 ? 's' : ''}`);\n        }\n\n        // Call onValidate callback\n        if (onValidate) {\n          onValidate(validationErrors);\n        }\n\n        // Update error markers in editor\n        if (editorRef.current && monacoRef.current) {\n          const model = editorRef.current.getModel();\n          if (model) {\n            const markers = validationErrors.map((err) => ({\n              severity: monacoRef.current!.MarkerSeverity.Error,\n              startLineNumber: err.line,\n              startColumn: err.column,\n              endLineNumber: err.line,\n              endColumn: err.column + err.length,\n              message: err.message,\n            }));\n\n            monacoRef.current.editor.setModelMarkers(model, 'rhai', markers);\n          }\n        }\n      } catch (err) {\n        console.error('Validation failed:', err);\n        setValidationStatus('Validation failed');\n      }\n    },\n    [isWasmReady, validateConfig, onValidate]\n  );\n\n  /**\n   * Handle editor value changes with debounced validation\n   */\n  const handleEditorChange = useCallback(\n    (newValue: string | undefined) => {\n      if (newValue === undefined) return;\n\n      // Call onChange callback immediately\n      if (onChange) {\n        onChange(newValue);\n      }\n\n      // Clear previous timeout\n      if (validationTimeoutRef.current) {\n        clearTimeout(validationTimeoutRef.current);\n      }\n\n      // Set new timeout for validation (500ms debounce)\n      validationTimeoutRef.current = setTimeout(() => {\n        runValidation(newValue);\n      }, 500);\n    },\n    [onChange, runValidation]\n  );\n\n  /**\n   * Run validation when value prop changes (initial load)\n   */\n  useEffect(() => {\n    if (value && isWasmReady) {\n      runValidation(value);\n    }\n  }, [value, isWasmReady, runValidation]);\n\n  /**\n   * Cleanup timeout on unmount\n   */\n  useEffect(() => {\n    return () => {\n      if (validationTimeoutRef.current) {\n        clearTimeout(validationTimeoutRef.current);\n      }\n    };\n  }, []);\n\n  return (\n    <div className=\"flex flex-col gap-2\">\n      <div className=\"flex items-center justify-between px-2 py-1 bg-slate-800 rounded text-sm\">\n        <span className=\"text-slate-400\">Rhai Configuration Editor</span>\n        <span\n          className={`font-mono ${\n            validationStatus.startsWith('✓')\n              ? 'text-green-400'\n              : validationStatus.startsWith('✗')\n              ? 'text-red-400'\n              : 'text-slate-400'\n          }`}\n        >\n          {validationStatus}\n        </span>\n      </div>\n\n      <Editor\n        height={height}\n        defaultLanguage=\"rhai\"\n        theme=\"rhai-dark\"\n        value={value}\n        onChange={handleEditorChange}\n        beforeMount={handleBeforeMount}\n        onMount={handleMount}\n        options={{\n          readOnly,\n        }}\n      />\n\n      {errors.length > 0 && (\n        <div className=\"px-2 py-1 bg-slate-800 rounded text-xs text-slate-400\">\n          Press F8 to navigate to next error\n        </div>\n      )}\n    </div>\n  );\n}\n","import React, { useState, useCallback, useRef, useEffect } from 'react';\nimport { KeyboardVisualizer } from '../components/KeyboardVisualizer';\nimport type { KeyMapping } from '@/types';\nimport { StateIndicatorPanel } from '../components/StateIndicatorPanel';\nimport { Button } from '../components/Button';\nimport { Card } from '../components/Card';\nimport { MonacoEditor } from '../components/MonacoEditor';\nimport { WasmProvider } from '../contexts/WasmContext';\nimport { useProfiles } from '../hooks/useProfiles';\nimport { useGetProfileConfig } from '../hooks/useProfileConfig';\nimport { useWasm, type SimulationInput } from '../hooks/useWasm';\nimport { getErrorMessage } from '../utils/errorUtils';\nimport type { DaemonState } from '../types/rpc';\nimport type { ValidationError } from '../hooks/useWasm';\n\ninterface SimulatorEvent {\n  timestamp: string;\n  type: 'press' | 'release' | 'wait' | 'output';\n  key?: string;\n  message: string;\n}\n\ninterface SimulatorState {\n  activeLayer: string;\n  modifiers: {\n    ctrl: boolean;\n    shift: boolean;\n    alt: boolean;\n    gui: boolean;\n  };\n  locks: {\n    capsLock: boolean;\n    numLock: boolean;\n    scrollLock: boolean;\n  };\n}\n\nconst MAX_EVENTS = 1000;\nconst AUTO_PAUSE_TIMEOUT = 60000; // 60 seconds\n\nexport const SimulatorPage: React.FC = () => {\n  const [pressedKeys, setPressedKeys] = useState<Set<string>>(new Set());\n  const [events, setEvents] = useState<SimulatorEvent[]>([]);\n  const [state, setState] = useState<SimulatorState>({\n    activeLayer: 'MD_00 (Base)',\n    modifiers: {\n      ctrl: false,\n      shift: false,\n      alt: false,\n      gui: false,\n    },\n    locks: {\n      capsLock: false,\n      numLock: false,\n      scrollLock: false,\n    },\n  });\n  const [isPaused, setIsPaused] = useState(false);\n  const [holdTimers, setHoldTimers] = useState<Map<string, number>>(new Map());\n  const autoPauseTimerRef = useRef<NodeJS.Timeout>();\n  const lastActivityRef = useRef<number>(Date.now());\n\n  // Profile selection\n  const [selectedProfile, setSelectedProfile] = useState<string>('');\n  const { data: profiles, isLoading: isLoadingProfiles } = useProfiles();\n  const { data: profileConfig, isLoading: isLoadingConfig } = useGetProfileConfig(selectedProfile);\n  const { isWasmReady, isLoading: isLoadingWasm, validateConfig, runSimulation } = useWasm();\n  const [configLoadError, setConfigLoadError] = useState<string | null>(null);\n  const [isUsingProfileConfig, setIsUsingProfileConfig] = useState(false);\n  const [wasmState, setWasmState] = useState<DaemonState | null>(null);\n\n  // Custom code editor mode\n  const [useCustomCode, setUseCustomCode] = useState(false);\n  const [customCode, setCustomCode] = useState<string>('// Write your Rhai configuration here\\n');\n  const [validationErrors, setValidationErrors] = useState<ValidationError[]>([]);\n\n  // Set the first profile as selected when profiles load\n  useEffect(() => {\n    if (profiles && profiles.length > 0 && !selectedProfile) {\n      setSelectedProfile(profiles[0].name);\n    }\n  }, [profiles, selectedProfile]);\n\n  // Validate and load profile config when it changes\n  useEffect(() => {\n    async function loadProfileConfig() {\n      if (!profileConfig || !isWasmReady) {\n        setIsUsingProfileConfig(false);\n        setConfigLoadError(null);\n        return;\n      }\n\n      try {\n        // Validate the config\n        const errors = await validateConfig(profileConfig.source);\n        if (errors.length > 0) {\n          const errorMsg = errors.map((e) => `Line ${e.line}: ${e.message}`).join('; ');\n          setConfigLoadError(errorMsg);\n          setIsUsingProfileConfig(false);\n          console.error('Profile config validation failed:', errorMsg);\n        } else {\n          setConfigLoadError(null);\n          setIsUsingProfileConfig(true);\n          console.info(`Profile \"${profileConfig.name}\" loaded successfully`);\n        }\n      } catch (err) {\n        const errorMsg = getErrorMessage(err, 'Failed to load profile config');\n        setConfigLoadError(errorMsg);\n        setIsUsingProfileConfig(false);\n        console.error('Failed to load profile config:', err);\n      }\n    }\n\n    loadProfileConfig();\n  }, [profileConfig, isWasmReady, validateConfig]);\n\n  // Mock key mappings for demonstration\n  const keyMappings = new Map<string, KeyMapping>([\n    [\n      'CAPS',\n      {\n        type: 'tap_hold',\n        tapAction: 'Escape',\n        holdAction: 'Ctrl',\n        threshold: 200,\n      },\n    ],\n    [\n      'SPACE',\n      {\n        type: 'tap_hold',\n        tapAction: 'Space',\n        holdAction: 'Layer_1',\n        threshold: 150,\n      },\n    ],\n  ]);\n\n  const addEvent = useCallback((event: Omit<SimulatorEvent, 'timestamp'>) => {\n    const timestamp = new Date().toLocaleTimeString('en-US', { hour12: false });\n    setEvents((prev) => {\n      const newEvents = [{ ...event, timestamp }, ...prev];\n      return newEvents.slice(0, MAX_EVENTS);\n    });\n  }, []);\n\n  const handleKeyPress = useCallback(\n    async (keyCode: string) => {\n      if (isPaused) return;\n\n      lastActivityRef.current = Date.now();\n\n      // Add to pressed keys\n      setPressedKeys((prev) => new Set(prev).add(keyCode));\n\n      // Add press event\n      addEvent({\n        type: 'press',\n        key: keyCode,\n        message: `Press ${keyCode}`,\n      });\n\n      // If WASM is ready and we have a valid profile config, use WASM simulation\n      if (isUsingProfileConfig && profileConfig && isWasmReady && runSimulation) {\n        try {\n          const input: SimulationInput = {\n            events: [\n              {\n                keycode: keyCode,\n                event_type: 'press',\n                timestamp_us: Date.now() * 1000,\n              },\n            ],\n          };\n\n          const result = await runSimulation(profileConfig.source, input);\n\n          if (result) {\n            // Update state from WASM result\n            setWasmState({\n              modifiers: result.final_state.active_modifiers.map((id) => `MD_${id.toString().padStart(2, '0')}`),\n              locks: result.final_state.active_locks.map((id) => `LK_${id.toString().padStart(2, '0')}`),\n              layer: result.final_state.active_layer || 'Base',\n            });\n\n            // Add output events to log\n            result.outputs.forEach((output) => {\n              addEvent({\n                type: 'output',\n                key: output.keycode,\n                message: `Output ${output.keycode} (${output.event_type})`,\n              });\n            });\n\n            // Update state display\n            setState({\n              activeLayer: result.final_state.active_layer || 'MD_00 (Base)',\n              modifiers: {\n                ctrl: result.final_state.active_modifiers.includes(0),\n                shift: result.final_state.active_modifiers.includes(1),\n                alt: result.final_state.active_modifiers.includes(2),\n                gui: result.final_state.active_modifiers.includes(3),\n              },\n              locks: {\n                capsLock: result.final_state.active_locks.includes(0),\n                numLock: result.final_state.active_locks.includes(1),\n                scrollLock: result.final_state.active_locks.includes(2),\n              },\n            });\n          }\n        } catch (err) {\n          console.error('WASM simulation error:', err);\n          addEvent({\n            type: 'output',\n            message: `WASM Error: ${getErrorMessage(err, 'Simulation failed')}`,\n          });\n        }\n      } else {\n        // Fallback to mock simulation\n        const mapping = keyMappings.get(keyCode);\n        if (mapping?.type === 'tap_hold' && mapping.threshold) {\n          // Start hold timer\n          const timerId = window.setTimeout(() => {\n            addEvent({\n              type: 'wait',\n              key: keyCode,\n              message: `→Wait ${mapping.threshold}ms (hold)`,\n            });\n            addEvent({\n              type: 'output',\n              key: keyCode,\n              message: `Output ${mapping.holdAction} (hold)`,\n            });\n\n            // Update modifiers if applicable\n            if (mapping.holdAction === 'Ctrl') {\n              setState((prev) => ({\n                ...prev,\n                modifiers: { ...prev.modifiers, ctrl: true },\n              }));\n            }\n          }, mapping.threshold);\n\n          setHoldTimers((prev) => new Map(prev).set(keyCode, timerId));\n        } else {\n          // Simple key press output\n          addEvent({\n            type: 'output',\n            key: keyCode,\n            message: `Output ${mapping?.tapAction || keyCode}`,\n          });\n        }\n      }\n    },\n    [isPaused, keyMappings, addEvent, isUsingProfileConfig, profileConfig, isWasmReady, runSimulation]\n  );\n\n  const handleKeyRelease = useCallback(\n    async (keyCode: string) => {\n      if (isPaused) return;\n\n      lastActivityRef.current = Date.now();\n\n      // Remove from pressed keys\n      setPressedKeys((prev) => {\n        const next = new Set(prev);\n        next.delete(keyCode);\n        return next;\n      });\n\n      // Add release event\n      addEvent({\n        type: 'release',\n        key: keyCode,\n        message: `Release ${keyCode}`,\n      });\n\n      // If WASM is ready and we have a valid profile config, use WASM simulation\n      if (isUsingProfileConfig && profileConfig && isWasmReady && runSimulation) {\n        try {\n          const input: SimulationInput = {\n            events: [\n              {\n                keycode: keyCode,\n                event_type: 'release',\n                timestamp_us: Date.now() * 1000,\n              },\n            ],\n          };\n\n          const result = await runSimulation(profileConfig.source, input);\n\n          if (result) {\n            // Update state from WASM result\n            setWasmState({\n              modifiers: result.final_state.active_modifiers.map((id) => `MD_${id.toString().padStart(2, '0')}`),\n              locks: result.final_state.active_locks.map((id) => `LK_${id.toString().padStart(2, '0')}`),\n              layer: result.final_state.active_layer || 'Base',\n            });\n\n            // Add output events to log\n            result.outputs.forEach((output) => {\n              addEvent({\n                type: 'output',\n                key: output.keycode,\n                message: `Output ${output.keycode} (${output.event_type})`,\n              });\n            });\n\n            // Update state display\n            setState({\n              activeLayer: result.final_state.active_layer || 'MD_00 (Base)',\n              modifiers: {\n                ctrl: result.final_state.active_modifiers.includes(0),\n                shift: result.final_state.active_modifiers.includes(1),\n                alt: result.final_state.active_modifiers.includes(2),\n                gui: result.final_state.active_modifiers.includes(3),\n              },\n              locks: {\n                capsLock: result.final_state.active_locks.includes(0),\n                numLock: result.final_state.active_locks.includes(1),\n                scrollLock: result.final_state.active_locks.includes(2),\n              },\n            });\n          }\n        } catch (err) {\n          console.error('WASM simulation error:', err);\n          addEvent({\n            type: 'output',\n            message: `WASM Error: ${getErrorMessage(err, 'Simulation failed')}`,\n          });\n        }\n      } else {\n        // Fallback to mock simulation\n        // Clear hold timer if exists\n        const timerId = holdTimers.get(keyCode);\n        if (timerId !== undefined) {\n          clearTimeout(timerId);\n          setHoldTimers((prev) => {\n            const next = new Map(prev);\n            next.delete(keyCode);\n            return next;\n          });\n\n          // If timer was still running, it was a tap\n          const mapping = keyMappings.get(keyCode);\n          if (mapping?.type === 'tap_hold') {\n            addEvent({\n              type: 'output',\n              key: keyCode,\n              message: `Output ${mapping.tapAction} (tap)`,\n            });\n          }\n        }\n\n        // Update modifiers if applicable\n        const mapping = keyMappings.get(keyCode);\n        if (mapping?.type === 'tap_hold' && mapping.holdAction === 'Ctrl') {\n          setState((prev) => ({\n            ...prev,\n            modifiers: { ...prev.modifiers, ctrl: false },\n          }));\n        }\n      }\n    },\n    [isPaused, holdTimers, keyMappings, addEvent, isUsingProfileConfig, profileConfig, isWasmReady, runSimulation]\n  );\n\n  const handleKeyClick = useCallback(\n    (keyCode: string) => {\n      if (pressedKeys.has(keyCode)) {\n        handleKeyRelease(keyCode);\n      } else {\n        handleKeyPress(keyCode);\n      }\n    },\n    [pressedKeys, handleKeyPress, handleKeyRelease]\n  );\n\n  const handleReset = useCallback(() => {\n    setPressedKeys(new Set());\n    setEvents([]);\n    setState({\n      activeLayer: 'MD_00 (Base)',\n      modifiers: {\n        ctrl: false,\n        shift: false,\n        alt: false,\n        gui: false,\n      },\n      locks: {\n        capsLock: false,\n        numLock: false,\n        scrollLock: false,\n      },\n    });\n    setWasmState(null);\n    setIsPaused(false);\n    holdTimers.forEach((timerId) => clearTimeout(timerId));\n    setHoldTimers(new Map());\n    lastActivityRef.current = Date.now();\n    addEvent({\n      type: 'output',\n      message: 'Simulator reset',\n    });\n  }, [holdTimers, addEvent]);\n\n  const handleCopyLog = useCallback(() => {\n    const logText = events\n      .map((e) => `${e.timestamp}  ${e.type.padEnd(8)}  ${e.message}`)\n      .join('\\n');\n    navigator.clipboard.writeText(logText);\n  }, [events]);\n\n  // Auto-pause after 60 seconds of inactivity\n  useEffect(() => {\n    autoPauseTimerRef.current = setInterval(() => {\n      const now = Date.now();\n      if (now - lastActivityRef.current > AUTO_PAUSE_TIMEOUT && !isPaused) {\n        setIsPaused(true);\n        addEvent({\n          type: 'output',\n          message: 'Auto-paused after 60 seconds of inactivity',\n        });\n      }\n    }, 1000);\n\n    return () => {\n      if (autoPauseTimerRef.current) {\n        clearInterval(autoPauseTimerRef.current);\n      }\n    };\n  }, [isPaused, addEvent]);\n\n  // Cleanup hold timers on unmount\n  useEffect(() => {\n    return () => {\n      holdTimers.forEach((timerId) => clearTimeout(timerId));\n    };\n  }, [holdTimers]);\n\n  return (\n    <div className=\"flex flex-col gap-4 md:gap-6 p-4 md:p-6 lg:p-8\">\n      <div className=\"flex flex-col lg:flex-row lg:items-start lg:justify-between gap-4\">\n        <div>\n          <h1 className=\"text-xl md:text-2xl lg:text-3xl font-bold text-slate-100\">\n            Keyboard Simulator\n          </h1>\n          <p className=\"text-sm md:text-base text-slate-400 mt-2\">\n            Test your configuration by clicking keys or typing. Changes are not\n            saved to your keyboard.\n          </p>\n        </div>\n        <div className=\"flex flex-col sm:flex-row gap-2\">\n          <Button\n            variant=\"secondary\"\n            size=\"md\"\n            onClick={handleCopyLog}\n            aria-label=\"Copy event log to clipboard\"\n            disabled={events.length === 0}\n            className=\"w-full sm:w-auto min-h-[44px] sm:min-h-0\"\n          >\n            Copy Event Log\n          </Button>\n          <Button\n            variant=\"danger\"\n            size=\"md\"\n            onClick={handleReset}\n            aria-label=\"Reset simulator state\"\n            className=\"w-full sm:w-auto min-h-[44px] sm:min-h-0\"\n          >\n            Reset Simulator\n          </Button>\n        </div>\n      </div>\n\n      {/* Configuration Mode Toggle */}\n      <Card aria-label=\"Configuration mode selector\">\n        <div className=\"flex flex-col gap-4\">\n          <div className=\"flex items-center gap-4\">\n            <span className=\"text-sm font-medium text-slate-300\">Configuration Mode:</span>\n            <div className=\"flex gap-2\">\n              <button\n                onClick={() => setUseCustomCode(false)}\n                className={`px-4 py-2 rounded-md text-sm font-medium transition-colors ${\n                  !useCustomCode\n                    ? 'bg-primary-500 text-white'\n                    : 'bg-slate-700 text-slate-300 hover:bg-slate-600'\n                }`}\n              >\n                Use Profile\n              </button>\n              <button\n                onClick={() => setUseCustomCode(true)}\n                className={`px-4 py-2 rounded-md text-sm font-medium transition-colors ${\n                  useCustomCode\n                    ? 'bg-primary-500 text-white'\n                    : 'bg-slate-700 text-slate-300 hover:bg-slate-600'\n                }`}\n              >\n                Edit Code (WASM)\n              </button>\n            </div>\n          </div>\n\n          {!useCustomCode ? (\n            // Profile selector mode\n            <div className=\"flex flex-col sm:flex-row sm:items-center gap-3\">\n              <label\n                htmlFor=\"profile-selector\"\n                className=\"text-sm font-medium text-slate-300 shrink-0\"\n              >\n                Select Profile:\n              </label>\n              <div className=\"flex-1\">\n                <select\n                  id=\"profile-selector\"\n                  value={selectedProfile}\n                  onChange={(e) => setSelectedProfile(e.target.value)}\n                  disabled={isLoadingProfiles || !profiles || profiles.length === 0}\n                  className=\"w-full sm:w-auto min-w-[200px] px-3 py-2 bg-slate-700 border border-slate-600 rounded-md text-slate-100 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed\"\n                  aria-label=\"Select profile for simulation\"\n                >\n                  {isLoadingProfiles ? (\n                    <option>Loading profiles...</option>\n                  ) : profiles && profiles.length > 0 ? (\n                    profiles.map((profile) => (\n                      <option key={profile.name} value={profile.name}>\n                        {profile.name}\n                        {profile.isActive ? ' [Active]' : ''}\n                      </option>\n                    ))\n                  ) : (\n                    <option>No profiles available</option>\n                  )}\n                </select>\n              </div>\n              <div className=\"flex items-center gap-2 text-xs text-slate-400\">\n                {isLoadingConfig && (\n                  <span className=\"flex items-center gap-1\">\n                    <svg\n                      className=\"animate-spin h-4 w-4\"\n                      xmlns=\"http://www.w3.org/2000/svg\"\n                      fill=\"none\"\n                      viewBox=\"0 0 24 24\"\n                    >\n                      <circle\n                        className=\"opacity-25\"\n                        cx=\"12\"\n                        cy=\"12\"\n                        r=\"10\"\n                        stroke=\"currentColor\"\n                        strokeWidth=\"4\"\n                      />\n                      <path\n                        className=\"opacity-75\"\n                        fill=\"currentColor\"\n                        d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n                      />\n                    </svg>\n                    Loading config...\n                  </span>\n                )}\n                {!isLoadingConfig && isUsingProfileConfig && (\n                  <span className=\"text-green-400 font-medium\">\n                    ✓ WASM Simulator Active\n                  </span>\n                )}\n                {!isLoadingConfig && profileConfig && !isUsingProfileConfig && !configLoadError && (\n                  <span className=\"text-yellow-400\">⚠ Using mock simulation (WASM not ready)</span>\n                )}\n                {!isWasmReady && !isLoadingWasm && (\n                  <span className=\"text-yellow-400\">\n                    ⚠ WASM not available (run build:wasm)\n                  </span>\n                )}\n              </div>\n            </div>\n          ) : (\n            // Custom code editor mode\n            <div className=\"flex flex-col gap-2\">\n              <div className=\"flex items-center justify-between\">\n                <p className=\"text-sm text-slate-400\">\n                  Edit Rhai configuration and test with WASM compilation + simulation\n                </p>\n                {validationErrors.length > 0 && (\n                  <span className=\"text-xs text-red-400\">\n                    {validationErrors.length} error{validationErrors.length > 1 ? 's' : ''}\n                  </span>\n                )}\n              </div>\n              <div className=\"h-[400px]\">\n                <MonacoEditor\n                  value={customCode}\n                  onChange={(value) => setCustomCode(value)}\n                  onValidate={setValidationErrors}\n                  height=\"400px\"\n                />\n              </div>\n            </div>\n          )}\n        </div>\n      </Card>\n\n      {/* Config Load Error */}\n      {configLoadError && (\n        <div\n          className=\"bg-red-500/10 border border-red-500 text-red-400 px-4 py-3 rounded-md\"\n          role=\"alert\"\n        >\n          <p className=\"font-medium\">Configuration Error</p>\n          <p className=\"text-sm mt-1\">\n            Failed to load profile configuration: {configLoadError}\n          </p>\n          <p className=\"text-xs mt-2 text-red-300\">\n            The simulator is using mock key mappings. Fix the configuration to use\n            real profile logic.\n          </p>\n        </div>\n      )}\n\n      {isPaused && (\n        <div\n          className=\"bg-yellow-500/10 border border-yellow-500 text-yellow-500 px-4 py-3 rounded-md\"\n          role=\"alert\"\n        >\n          <p className=\"font-medium\">Simulator Paused</p>\n          <p className=\"text-sm mt-1\">\n            The simulator has been paused after 60 seconds of inactivity. Click\n            any key to resume.\n          </p>\n        </div>\n      )}\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6\">\n        {/* State Display */}\n        <Card className=\"lg:col-span-1\" aria-labelledby=\"simulator-state-heading\">\n          <h2 id=\"simulator-state-heading\" className=\"text-base md:text-lg font-semibold text-slate-100 mb-3\">\n            State Inspector\n          </h2>\n          {isUsingProfileConfig && wasmState ? (\n            <StateIndicatorPanel state={wasmState} />\n          ) : (\n            <div className=\"space-y-3 md:space-y-4\">\n              <div>\n                <div className=\"space-y-2\">\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"text-sm text-slate-400\">Active Layer:</span>\n                    <span className=\"text-sm font-mono text-slate-100\">\n                      {state.activeLayer}\n                    </span>\n                  </div>\n                </div>\n              </div>\n\n              <div>\n                <h3 className=\"text-sm font-medium text-slate-300 mb-2\">\n                  Modifiers\n                </h3>\n                <div className=\"grid grid-cols-2 gap-2\">\n                  {Object.entries(state.modifiers).map(([key, active]) => (\n                    <div\n                      key={key}\n                      className={`px-3 py-2 rounded text-xs font-mono text-center transition-colors ${\n                        active\n                          ? 'bg-green-500 text-white'\n                          : 'bg-slate-700 text-slate-400'\n                      }`}\n                    >\n                      {key.charAt(0).toUpperCase() + key.slice(1)}{' '}\n                      {active ? '✓' : ''}\n                    </div>\n                  ))}\n                </div>\n              </div>\n\n              <div>\n                <h3 className=\"text-sm font-medium text-slate-300 mb-2\">\n                  Locks\n                </h3>\n                <div className=\"grid grid-cols-1 gap-2\">\n                  {Object.entries(state.locks).map(([key, active]) => (\n                    <div\n                      key={key}\n                      className={`px-3 py-2 rounded text-xs font-mono text-center transition-colors ${\n                        active\n                          ? 'bg-blue-500 text-white'\n                          : 'bg-slate-700 text-slate-400'\n                      }`}\n                    >\n                      {key\n                        .replace(/([A-Z])/g, ' $1')\n                        .trim()\n                        .split(' ')\n                        .map((w) => w.charAt(0).toUpperCase() + w.slice(1))\n                        .join(' ')}{' '}\n                      {active ? '✓' : ''}\n                    </div>\n                  ))}\n                </div>\n              </div>\n              {!isUsingProfileConfig && (\n                <p className=\"text-xs text-slate-500 mt-2\">\n                  Using mock state. Select a valid profile to see WASM state.\n                </p>\n              )}\n            </div>\n          )}\n        </Card>\n\n        {/* Event Log */}\n        <Card className=\"lg:col-span-2\" aria-labelledby=\"simulator-event-log-heading\">\n          <h2 id=\"simulator-event-log-heading\" className=\"text-base md:text-lg font-semibold text-slate-100 mb-3\">\n            Event Log\n            <span className=\"text-xs md:text-sm font-normal text-slate-400 ml-2\">\n              (last {Math.min(events.length, MAX_EVENTS)} events)\n            </span>\n          </h2>\n          <div className=\"bg-slate-900 rounded-md p-3 md:p-4 h-48 md:h-64 overflow-y-auto font-mono text-xs\">\n            {events.length === 0 ? (\n              <div className=\"flex items-center justify-center h-full text-slate-500\">\n                No events yet. Click a key to start.\n              </div>\n            ) : (\n              <div className=\"space-y-1\">\n                {events.map((event, index) => (\n                  <div\n                    key={`${event.timestamp}-${index}`}\n                    className=\"flex items-start gap-3\"\n                  >\n                    <span className=\"text-slate-500 shrink-0\">\n                      {event.timestamp}\n                    </span>\n                    <span\n                      className={`shrink-0 ${\n                        event.type === 'press'\n                          ? 'text-green-400'\n                          : event.type === 'release'\n                            ? 'text-red-400'\n                            : event.type === 'wait'\n                              ? 'text-yellow-400'\n                              : 'text-blue-400'\n                      }`}\n                    >\n                      {event.type.toUpperCase().padEnd(8)}\n                    </span>\n                    <span className=\"text-slate-300\">{event.message}</span>\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        </Card>\n      </div>\n\n      {/* Keyboard Visualizer */}\n      <Card aria-labelledby=\"interactive-keyboard-heading\">\n        <h2 id=\"interactive-keyboard-heading\" className=\"text-base md:text-lg font-semibold text-slate-100 mb-4\">\n          Interactive Keyboard\n        </h2>\n        <div className=\"flex justify-center overflow-x-auto md:overflow-x-visible\">\n          <KeyboardVisualizer\n            layout=\"ANSI_104\"\n            keyMappings={keyMappings}\n            onKeyClick={handleKeyClick}\n            simulatorMode={true}\n            pressedKeys={pressedKeys}\n          />\n        </div>\n        <p className=\"text-xs text-slate-500 mt-4 text-center\">\n          Click keys to simulate press/release. Hold-configured keys will show\n          timer behavior.\n        </p>\n      </Card>\n    </div>\n  );\n};\n\n// Wrap with WasmProvider to enable WASM features (MonacoEditor validation, compilation, simulation)\nconst SimulatorPageWithWasm: React.FC = () => (\n  <WasmProvider>\n    <SimulatorPage />\n  </WasmProvider>\n);\n\nexport default SimulatorPageWithWasm;\n","import { useCallback, useEffect, useState } from 'react';\n\n/**\n * Validation error structure returned by WASM validator\n */\nexport interface ValidationError {\n  line: number;\n  column: number;\n  length: number;\n  message: string;\n}\n\n/**\n * Simulation result structure returned by WASM simulator\n */\nexport interface SimulationResult {\n  states: StateTransition[];\n  outputs: KeyEvent[];\n  latency: number[];\n  final_state: {\n    active_modifiers: number[];\n    active_locks: number[];\n    active_layer: string | null;\n  };\n}\n\ninterface StateTransition {\n  timestamp_us: number;\n  active_modifiers: number[];\n  active_locks: number[];\n  active_layer: string | null;\n}\n\ninterface KeyEvent {\n  keycode: string;\n  event_type: 'press' | 'release';\n  timestamp_us: number;\n}\n\n/**\n * Input event for simulation\n */\nexport interface SimulationInput {\n  events: Array<{\n    keycode: string;\n    event_type: 'press' | 'release';\n    timestamp_us: number;\n  }>;\n}\n\n// Type definitions for WASM module\ninterface WasmModule {\n  wasm_init: () => void;\n  load_config: (source: string) => number; // Returns ConfigHandle\n  simulate: (configHandle: number, eventsJson: string) => unknown;\n}\n\n/**\n * Hook for integrating with WASM module for validation and simulation\n *\n * @returns Object containing WASM initialization status and validation/simulation functions\n */\nexport function useWasm() {\n  const [isWasmReady, setIsWasmReady] = useState(false);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState<Error | null>(null);\n  const [wasmModule, setWasmModule] = useState<WasmModule | null>(null);\n\n  useEffect(() => {\n    // Initialize WASM module\n    async function initWasm() {\n      const startTime = performance.now();\n      console.info('[WASM] Starting initialization...');\n      setIsLoading(true);\n\n      try {\n        // Try to dynamically import the WASM module\n        // The path will be correct once WASM is built (Task 25-26)\n        console.info('[WASM] Fetching module...');\n        const module = await import('@/wasm/pkg/keyrx_core.js').catch(() => {\n          throw new Error('WASM module not found. Run build:wasm to compile the WASM module.');\n        });\n\n        console.info('[WASM] Module loaded, initializing...');\n        // Initialize WASM with panic hook\n        module.wasm_init();\n\n        const loadTime = performance.now() - startTime;\n        setWasmModule(module as unknown as WasmModule);\n        setIsWasmReady(true);\n        setIsLoading(false);\n        console.info(`[WASM] Initialized successfully in ${loadTime.toFixed(0)}ms`);\n      } catch (err) {\n        const errorMessage = err instanceof Error ? err.message : String(err);\n        const loadTime = performance.now() - startTime;\n        console.warn(`[WASM] Initialization failed after ${loadTime.toFixed(0)}ms:`, errorMessage);\n        setError(err instanceof Error ? err : new Error(errorMessage));\n        setIsWasmReady(false);\n        setIsLoading(false);\n      }\n    }\n\n    initWasm();\n  }, []);\n\n  /**\n   * Validate Rhai configuration code\n   *\n   * Uses the WASM load_config function which validates and parses the configuration.\n   * If parsing fails, it returns validation errors with line/column information.\n   *\n   * @param code - Rhai configuration code to validate\n   * @returns Array of validation errors, empty if valid\n   */\n  const validateConfig = useCallback(\n    async (code: string): Promise<ValidationError[]> => {\n      if (!isWasmReady || !wasmModule) {\n        // Return empty array if WASM not ready - graceful degradation\n        console.debug('WASM not ready, skipping validation');\n        return [];\n      }\n\n      try {\n        // Use load_config to validate - it will throw if invalid\n        wasmModule.load_config(code);\n        // If we get here, the config is valid\n        return [];\n      } catch (err) {\n        // Parse error message to extract line/column information\n        const errorMessage = err instanceof Error ? err.message : String(err);\n        console.debug('Validation error:', errorMessage);\n\n        // Try to extract line number from error message\n        // Rhai errors typically include line information\n        const lineMatch = errorMessage.match(/line (\\d+)/i);\n        const columnMatch = errorMessage.match(/column (\\d+)/i);\n\n        const line = lineMatch ? parseInt(lineMatch[1], 10) : 1;\n        const column = columnMatch ? parseInt(columnMatch[1], 10) : 1;\n\n        return [\n          {\n            line,\n            column,\n            length: 1,\n            message: errorMessage,\n          },\n        ];\n      }\n    },\n    [isWasmReady, wasmModule]\n  );\n\n  /**\n   * Run simulation with Rhai configuration\n   *\n   * @param code - Rhai configuration code\n   * @param input - Input events for simulation\n   * @returns Simulation results\n   */\n  const runSimulation = useCallback(\n    async (code: string, input: SimulationInput): Promise<SimulationResult | null> => {\n      if (!isWasmReady || !wasmModule) {\n        // Return null if WASM not ready - graceful degradation\n        console.debug('WASM not ready, skipping simulation');\n        return null;\n      }\n\n      try {\n        // Load the configuration\n        const configHandle = wasmModule.load_config(code);\n\n        // Run simulation\n        const inputJson = JSON.stringify(input);\n        const result = wasmModule.simulate(configHandle, inputJson);\n\n        // Parse and return the result\n        return result as SimulationResult;\n      } catch (err) {\n        const errorMessage = err instanceof Error ? err.message : String(err);\n        console.error('Simulation error:', errorMessage);\n        return null;\n      }\n    },\n    [isWasmReady, wasmModule]\n  );\n\n  return {\n    isWasmReady,\n    isLoading,\n    error,\n    validateConfig,\n    runSimulation,\n  };\n}\n"],"file":"SimulatorPage-5GKM6tMR.js"}