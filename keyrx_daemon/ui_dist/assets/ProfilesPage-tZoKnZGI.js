import{k as e,R as a,j as s,l as i,F as l,T as t,n as r,u as n,r as o,o as d,p as c,q as m}from"./vendor-DchKSmaM.js";import{a as x,C as p}from"./client-DsuQMGGi.js";import{B as f}from"./index-DNY7ggn3.js";import{T as h}from"./Tooltip-Eiv0HiOq.js";import{M as u}from"./Modal-KUDrpHjH.js";import{I as g}from"./Input-DwmkWAVg.js";import{S as j}from"./LoadingSkeleton-DwR2jlpO.js";import{u as v,a as b,b as N,c as y}from"./useProfiles-MkTJ18U7.js";import{g as C}from"./errorUtils-C0i9WI_e.js";import"./schemas-DRbUxdzV.js";const k=a.memo(({name:a,description:n,isActive:o,lastModified:d,rhaiPath:c,fileExists:m=!0,onActivate:u,onEdit:g,onDelete:j,onPathClick:v})=>{const{data:b,isLoading:N}=function(a){const{enabled:s=!0,staleTime:i=6e4}={};return e({queryKey:["profile-validation",a],queryFn:()=>async function(e){return x.post(`/api/profiles/${e}/validate`)}(a),enabled:s&&!!a,staleTime:i,retry:1,refetchOnWindowFocus:!1})}(a),y=b?.valid??!0,C=(b?.errors??[])[0],k=c?function(e,a=50){const s=e.replace(/^\/home\/[^/]+/,"~");if(s.length<=a)return s;const i=s.split("/");if(i.length<=2)return"..."+s.slice(-(a-3));const l=`${i.slice(0,2).join("/")}/.../${i[i.length-1]}`;return l.length<=a?l:"..."+s.slice(-(a-3))}(c,40):null;return s.jsxs(p,{variant:"default",padding:"md",className:"relative "+(o?"border-green-500 border-2":""),children:[o&&s.jsxs("div",{className:"absolute top-2 right-2 flex items-center gap-1 bg-green-500 text-white px-2 py-1 rounded text-xs font-semibold",children:[s.jsx(i,{size:14,"aria-hidden":"true"}),s.jsx("span",{children:"ACTIVE"})]}),s.jsxs("div",{className:"flex items-start gap-2 mb-2",children:[o&&s.jsx(i,{size:20,className:"text-green-500 flex-shrink-0 mt-1","aria-label":"Active profile indicator"}),s.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:a})]}),n&&s.jsx("p",{className:"text-sm text-slate-400 mb-3 line-clamp-2",children:n}),c&&s.jsx("div",{className:"mb-3",children:s.jsx(h,{content:c,position:"top",children:s.jsxs("button",{onClick:v||g,className:"inline-flex items-center gap-1.5 text-xs text-slate-400 hover:text-blue-400 transition-colors group max-w-full","aria-label":`Open configuration file: ${c}`,children:[s.jsx(l,{size:14,className:"flex-shrink-0 group-hover:text-blue-400","aria-hidden":"true"}),s.jsx("span",{className:"truncate font-mono",children:k}),!m&&s.jsx(t,{size:14,className:"flex-shrink-0 text-yellow-500","aria-label":"File not found"})]})})}),!N&&s.jsx("div",{className:"mb-3",children:y?s.jsxs("div",{className:"inline-flex items-center gap-1 bg-green-900/30 text-green-400 border border-green-700 px-2 py-1 rounded text-xs font-medium",children:[s.jsx(r,{size:14,"aria-hidden":"true"}),s.jsx("span",{children:"Valid"})]}):s.jsx(h,{content:C?`Line ${C.line}: ${C.message}`:"Invalid configuration",position:"top",children:s.jsxs("div",{className:"inline-flex items-center gap-1 bg-yellow-900/30 text-yellow-400 border border-yellow-700 px-2 py-1 rounded text-xs font-medium cursor-help",children:[s.jsx(t,{size:14,"aria-hidden":"true"}),s.jsx("span",{children:"Invalid Configuration"})]})})}),d&&s.jsxs("p",{className:"text-xs text-slate-500 mb-4",children:["Modified: ",d]}),s.jsxs("div",{className:"flex gap-2 flex-wrap",children:[!o&&s.jsx(f,{variant:"primary",size:"sm",onClick:u,disabled:!y,"aria-label":y?`Activate profile ${a}`:`Cannot activate invalid profile ${a}`,children:"Activate"}),s.jsx(f,{variant:"secondary",size:"sm",onClick:g,"aria-label":`Edit profile ${a}`,children:"Edit"}),s.jsx(f,{variant:"danger",size:"sm",onClick:j,"aria-label":`Delete profile ${a}`,disabled:o,children:"Delete"})]})]})});k.displayName="ProfileCard";const w=()=>{const e=n(),{data:a,isLoading:i,error:l}=v(),t=b(),r=N(),x=y(),p=o.useMemo(()=>a?a.map(e=>({id:e.name,name:e.name,description:void 0,isActive:e.isActive,lastModified:new Date(e.modifiedAt).toLocaleString("en-CA",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}),rhaiPath:e.rhaiPath,fileExists:!0})):[],[a]),[h,w]=o.useState(!1),[P,z]=o.useState(!1),[S,A]=o.useState(!1),[E,D]=o.useState(null),[$,L]=o.useState(""),[F,T]=o.useState(""),[M,R]=o.useState("blank"),[I,q]=o.useState(""),[U,B]=o.useState(null),[O,V]=o.useState(null),[_,K]=o.useState(null),[G,H]=o.useState(!1),J=o.useRef(!1);o.useEffect(()=>{i||l||J.current||0!==p.length||(J.current=!0,W())},[i,l,p.length]);const W=async()=>{H(!0),K(null);try{await t.mutateAsync({name:"default",template:"blank"}),await r.mutateAsync("default"),V('Default profile created. Click "Edit" to customize.'),setTimeout(()=>{V(null)},5e3)}catch(e){const a=C(e,"Failed to create default profile");a.includes("Failed to fetch")||a.includes("NetworkError")?K("Unable to connect to daemon. Please ensure the daemon is running and try again."):K(a)}finally{H(!1)}},Q=e=>e.trim()?e.length>50?(q("Profile name must be 50 characters or less"),!1):p.some(a=>a.name===e&&a.id!==E?.id)?(q("Profile name already exists"),!1):(q(""),!0):(q("Profile name is required"),!1),X=()=>{w(!1),L(""),T(""),R("blank"),q("")},Y=()=>{z(!1),D(null),L(""),T(""),q("")};return i?s.jsxs("div",{className:"flex flex-col gap-4 md:gap-6 p-4 md:p-6 lg:p-8",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[s.jsx(j,{className:"h-8 w-32"}),s.jsx(j,{className:"h-10 w-40"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:[s.jsx(j,{}),s.jsx(j,{}),s.jsx(j,{})]})]}):s.jsxs("div",{className:"flex flex-col gap-4 md:gap-6 p-4 md:p-6 lg:p-8",children:[l&&s.jsx("div",{className:"p-4 bg-red-500/10 border border-red-500/20 rounded-lg",children:s.jsxs("p",{className:"text-sm text-red-400",children:["Failed to load profiles: ",l instanceof Error?l.message:"Unknown error"]})}),U&&s.jsx("div",{className:"p-4 bg-red-500/10 border border-red-500/20 rounded-lg",children:s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm font-semibold text-red-400 mb-2",children:"Profile Activation Error"}),s.jsx("pre",{className:"text-xs text-red-300 whitespace-pre-wrap font-mono",children:U})]}),s.jsx("button",{onClick:()=>B(null),className:"text-red-400 hover:text-red-300 ml-4","aria-label":"Dismiss error",children:"×"})]})}),O&&s.jsx("div",{className:"p-4 bg-green-500/10 border border-green-500/20 rounded-lg",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(d,{size:20,className:"text-green-400 flex-shrink-0 mt-0.5","aria-hidden":"true"}),s.jsx("div",{className:"flex-1",children:s.jsx("p",{className:"text-sm text-green-300",children:O})}),s.jsx("button",{onClick:()=>V(null),className:"text-green-400 hover:text-green-300 ml-2","aria-label":"Dismiss notification",children:"×"})]})}),_&&s.jsx("div",{className:"p-4 bg-red-500/10 border border-red-500/20 rounded-lg",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(c,{size:20,className:"text-red-400 flex-shrink-0 mt-0.5","aria-hidden":"true"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm font-semibold text-red-400 mb-2",children:"Failed to Create Default Profile"}),s.jsx("p",{className:"text-sm text-red-300 mb-3",children:_}),s.jsx(f,{variant:"secondary",size:"sm",onClick:()=>{W()},disabled:G,"aria-label":"Retry creating default profile",children:G?"Retrying...":"Retry"})]}),s.jsx("button",{onClick:()=>K(null),className:"text-red-400 hover:text-red-300 ml-2","aria-label":"Dismiss error",children:"×"})]})}),s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[s.jsx("h1",{className:"text-xl md:text-2xl lg:text-3xl font-semibold text-slate-100",children:"Profiles"}),s.jsxs(f,{variant:"primary",size:"md",onClick:()=>w(!0),"aria-label":"Create new profile",className:"w-full sm:w-auto min-h-[44px] sm:min-h-0",children:[s.jsx(m,{size:20,className:"mr-2","aria-hidden":"true"}),"Create Profile"]})]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:p.map(a=>s.jsx(k,{name:a.name,description:a.description,isActive:a.isActive,lastModified:a.lastModified,rhaiPath:a.rhaiPath,fileExists:a.fileExists,onActivate:()=>(async e=>{B(null);try{const a=await r.mutateAsync(e);if(a.errors&&a.errors.length>0){const e=a.errors.join("\n");B(`Compilation failed:\n${e}`)}}catch(a){const e=C(a,"Unknown error occurred");B(`Failed to activate profile: ${e}`)}})(a.id),onEdit:()=>(e=>{D(e),L(e.name),T(e.description||""),z(!0)})(a),onDelete:()=>(e=>{D(e),A(!0)})(a),onPathClick:()=>{return s=a.name,void e(`/profiles/${s}/config`);var s}},a.id))}),s.jsx(u,{open:h,onClose:X,title:"Create New Profile",children:s.jsxs("div",{className:"flex flex-col gap-md",children:[s.jsx(g,{type:"text",value:$,onChange:e=>{L(e),I&&Q(e)},"aria-label":"Profile name",placeholder:"Profile name",error:I,maxLength:50}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx("label",{htmlFor:"template-select",className:"text-sm font-medium text-slate-300",children:"Starting Template"}),s.jsxs("select",{id:"template-select",value:M,onChange:e=>R(e.target.value),className:"w-full px-3 py-2 bg-slate-800 border border-slate-700 rounded-md text-slate-100 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500","aria-label":"Select profile template",children:[s.jsx("option",{value:"blank",children:"Blank - Empty configuration"}),s.jsx("option",{value:"simple_remap",children:"Simple Remap - Basic key remapping examples"}),s.jsx("option",{value:"capslock_escape",children:"CapsLock→Escape - CapsLock as Escape key"}),s.jsx("option",{value:"vim_navigation",children:"Vim Navigation - HJKL arrow keys layer"}),s.jsx("option",{value:"gaming",children:"Gaming - Optimized for gaming"})]}),s.jsx("p",{className:"text-xs text-slate-400",children:"Choose a starting template for your profile configuration"})]}),s.jsx(g,{type:"text",value:F,onChange:e=>T(e),"aria-label":"Profile description",placeholder:"Description (optional)",maxLength:200}),s.jsxs("div",{className:"flex gap-2 justify-end mt-2",children:[s.jsx(f,{variant:"secondary",size:"md",onClick:X,"aria-label":"Cancel creating profile",children:"Cancel"}),s.jsx(f,{variant:"primary",size:"md",onClick:async()=>{if(Q($))try{await t.mutateAsync({name:$,template:M}),w(!1),L(""),T(""),R("blank"),q("")}catch(e){q(C(e,"Failed to create profile"))}},"aria-label":"Save new profile",children:"Create"})]})]})}),s.jsx(u,{open:P,onClose:Y,title:"Edit Profile",children:s.jsxs("div",{className:"flex flex-col gap-md",children:[s.jsx(g,{type:"text",value:$,onChange:e=>{L(e),I&&Q(e)},"aria-label":"Profile name",placeholder:"Profile name",error:I,maxLength:50}),s.jsx(g,{type:"text",value:F,onChange:e=>T(e),"aria-label":"Profile description",placeholder:"Description (optional)",maxLength:200}),s.jsxs("div",{className:"flex gap-2 justify-end mt-2",children:[s.jsx(f,{variant:"secondary",size:"md",onClick:Y,"aria-label":"Cancel editing profile",children:"Cancel"}),s.jsx(f,{variant:"primary",size:"md",onClick:async()=>{E&&Q($)&&(z(!1),D(null),L(""),T(""),q(""))},"aria-label":"Save profile changes",children:"Save"})]})]})}),s.jsx(u,{open:S,onClose:()=>A(!1),title:"Delete Profile",children:s.jsxs("div",{className:"flex flex-col gap-md",children:[s.jsxs("p",{className:"text-slate-300",children:["Are you sure you want to delete the profile"," ",s.jsx("strong",{className:"text-white",children:E?.name}),"? This action cannot be undone."]}),s.jsxs("div",{className:"flex gap-2 justify-end mt-2",children:[s.jsx(f,{variant:"secondary",size:"md",onClick:()=>A(!1),"aria-label":"Cancel deleting profile",children:"Cancel"}),s.jsx(f,{variant:"danger",size:"md",onClick:async()=>{if(E)try{await x.mutateAsync(E.name),A(!1),D(null)}catch(e){}},"aria-label":"Confirm delete profile",children:"Delete"})]})]})})]})};export{w as ProfilesPage,w as default};
//# sourceMappingURL=ProfilesPage-tZoKnZGI.js.map
