import{k as e,h as r,i}from"./vendor-DchKSmaM.js";import{q as t}from"./index-DNY7ggn3.js";import{a as s}from"./client-DsuQMGGi.js";import{v as a,A as o,b as n,c as u}from"./schemas-DRbUxdzV.js";async function c(){const e=await s.get("/api/profiles");return a(u,e,"GET /api/profiles").profiles.map(e=>({name:e.name,rhaiPath:e.rhaiPath,krxPath:e.krxPath,createdAt:e.createdAt,modifiedAt:e.modifiedAt,deviceCount:e.deviceCount,keyCount:e.keyCount,isActive:e.isActive}))}function f(){return e({queryKey:t.profiles,queryFn:c})}function l(){const{data:e}=f();return e?.find(e=>e.isActive)??null}function p(){const e=r();return i({mutationFn:({name:e,template:r})=>async function(e,r){const i={name:e,template:r},t=await s.post("/api/profiles",i);return a(n,t,"POST /api/profiles"),{success:!0}}(e,r),onSuccess:()=>{e.invalidateQueries({queryKey:t.profiles})}})}function y(){const e=r();return i({mutationFn:e=>async function(e){const r=await s.post(`/api/profiles/${e}/activate`),i=a(o,r,`POST /api/profiles/${e}/activate`);return{success:i.success,profile:e,compiledSize:0,compileTimeMs:i.compile_time_ms,errors:i.error?[i.error]:[]}}(e),onMutate:async r=>{await e.cancelQueries({queryKey:t.profiles});const i=e.getQueryData(t.profiles);return e.setQueryData(t.profiles,e=>e?.map(e=>({...e,isActive:e.name===r}))),{previousProfiles:i}},onError:(r,i,s)=>{s?.previousProfiles&&e.setQueryData(t.profiles,s.previousProfiles)},onSuccess:(r,i,s)=>{r.errors&&r.errors.length>0?s?.previousProfiles&&e.setQueryData(t.profiles,s.previousProfiles):(e.invalidateQueries({queryKey:t.profiles}),e.invalidateQueries({queryKey:["config"]}),e.invalidateQueries({queryKey:t.daemonState}),e.invalidateQueries({queryKey:t.activeProfile}))}})}function m(){const e=r();return i({mutationFn:r=>{const i=e.getQueryData(t.profiles),a=i?.find(e=>e.name===r);if(a?.isActive)throw new Error("Cannot delete the active profile");return async function(e){return await s.delete(`/api/profiles/${e}`),{success:!0}}(r)},onMutate:async r=>{await e.cancelQueries({queryKey:t.profiles});const i=e.getQueryData(t.profiles);return e.setQueryData(t.profiles,e=>e?.filter(e=>e.name!==r)),{previousProfiles:i}},onError:(r,i,s)=>{s?.previousProfiles&&e.setQueryData(t.profiles,s.previousProfiles)},onSuccess:()=>{e.invalidateQueries({queryKey:t.profiles})}})}export{p as a,y as b,m as c,l as d,f as u};
//# sourceMappingURL=useProfiles-MkTJ18U7.js.map
