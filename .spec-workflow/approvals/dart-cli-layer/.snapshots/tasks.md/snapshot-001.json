{
  "id": "snapshot_1766145576323_x0viu1utl",
  "approvalId": "approval_1766145576286_o0y89juf3",
  "approvalTitle": "Tasks for Dart CLI Layer",
  "version": 1,
  "timestamp": "2025-12-19T11:59:36.323Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Tasks Document\n\n- [ ] 1. Create core_logic package\n  - File: packages/core_logic/pubspec.yaml\n  - Create a new Dart package using `dart create -t package`.\n  - Add dependencies: `ffi`, `freezed_annotation`, `json_annotation`.\n  - Purpose: Establish the shared library.\n  - _Requirements: 1, Non-Functional (Package Separation)_\n  - _Prompt: Role: Dart Developer | Task: Create the 'core_logic' package structure and pubspec.yaml following Requirement 1. Include dependencies for ffi, freezed_annotation, and json_annotation. | Restrictions: Do not include flutter dependencies. | Success: Package created and `dart pub get` succeeds._\n\n- [ ] 2. Move Models to core_logic\n  - File: packages/core_logic/lib/models/\n  - Move model files from `ui/lib/models/` to `packages/core_logic/lib/models/`.\n  - Update imports within the files to be relative or package-absolute.\n  - Purpose: Share data structures.\n  - _Leverage: ui/lib/models/_\n  - _Requirements: 4_\n  - _Prompt: Role: Refactoring Specialist | Task: Move data models from `ui/lib/models` to `packages/core_logic/lib/models`. Update imports to be self-contained within the package. | Restrictions: Ensure no Flutter dependencies remain in the models. | Success: Models compile in the new package._\n\n- [ ] 3. Move FFI Bridge to core_logic\n  - File: packages/core_logic/lib/ffi/\n  - Move FFI binding code from `ui/lib/ffi/` to `packages/core_logic/lib/ffi/`.\n  - Update paths to load the dynamic library (might need logic to find it relative to script vs app).\n  - Purpose: Share access to Rust core.\n  - _Leverage: ui/lib/ffi/_\n  - _Requirements: 1_\n  - _Prompt: Role: Systems Programmer (Dart/Rust) | Task: Migrate FFI bridge code to `packages/core_logic/lib/ffi`. Implement robust library loading logic that works for both Flutter (AOT/JIT) and Dart CLI (JIT/exe). | Restrictions: Handle different platform paths for the dylib. | Success: FFI initializes correctly in a standalone Dart script._\n\n- [ ] 4. Refactor UI to use core_logic\n  - File: ui/pubspec.yaml, ui/lib/**/*\n  - Add `core_logic` as a path dependency in `ui`.\n  - Update UI imports to use `package:core_logic/...`.\n  - Purpose: Restore UI functionality.\n  - _Requirements: Non-Functional (Package Separation)_\n  - _Prompt: Role: Flutter Developer | Task: Update `ui/pubspec.yaml` to depend on `packages/core_logic`. mass-replace imports in `ui/lib` to point to the new package. | Restrictions: Verify the app still compiles. | Success: `flutter build linux` succeeds._\n\n- [ ] 5. Create CLI Tool Structure\n  - File: apps/cli_tool/pubspec.yaml, apps/cli_tool/bin/keyrx_cli.dart\n  - Create `apps/cli_tool` package.\n  - specificy dependency on `core_logic`.\n  - Implement basic argument parsing.\n  - Purpose: The harness entry point.\n  - _Requirements: 2_\n  - _Prompt: Role: Tooling Engineer | Task: Scaffold the `apps/cli_tool` package and a main entry point that parses arguments. Depend on `core_logic`. | Restrictions: Keep it lightweight. | Success: `dart run bin/keyrx_cli.dart --help` runs._\n\n- [ ] 6. Implement JSON Command Processor\n  - File: apps/cli_tool/lib/command_processor.dart\n  - Implement logic to decode JSON, map to `core_logic` calls, and encode responses.\n  - Purpose: The \"Brain\" of the harness.\n  - _Requirements: 2, 4_\n  - _Prompt: Role: Backend Developer | Task: Implement the JSON command processing loop. Map at least one command (e.g., 'status' or 'echo') to prove the concept. | Restrictions: Handle JSON errors gracefully. | Success: Inputting `{\"command\": \"echo\", \"payload\": \"test\"}` returns valid JSON._\n\n- [ ] 7. Create End-to-End Test Script\n  - File: scripts/e2e_test_headless.sh\n  - Create a shell script that compiles the CLI and runs a sequence of JSON tests.\n  - Purpose: Verify the \"Headless Harness\" strategy.\n  - _Requirements: 3_\n  - _Prompt: Role: QA Automation Engineer | Task: Write a shell script `scripts/e2e_test_headless.sh` that builds the Rust core, runs the Dart CLI, and feeds it a test scenario. | Restrictions: Fail if output doesn't match expected JSON. | Success: The script runs and passes._\n",
  "fileStats": {
    "size": 4070,
    "lines": 59,
    "lastModified": "2025-12-19T11:59:36.208Z"
  },
  "comments": []
}