{
  "id": "snapshot_1764767192966_odvqgew8i",
  "approvalId": "approval_1764767192948_vff06o9ek",
  "approvalTitle": "Test Organization - Tasks",
  "version": 1,
  "timestamp": "2025-12-03T13:06:32.966Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Tasks Document\n\n## Phase 1: Infrastructure\n\n- [ ] 1. Create test directory structure\n  - Files: `core/tests/{fixtures,unit,integration,e2e}/mod.rs`\n  - Create directory hierarchy as designed\n  - Add mod.rs files with documentation\n  - Purpose: Foundation for test organization\n  - _Leverage: Rust test conventions_\n  - _Requirements: 2.1, 2.2, 2.4_\n  - _Prompt: Implement the task for spec test-organization, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer setting up test infrastructure | Task: Create test directory structure in core/tests/ with unit/integration/e2e/fixtures subdirectories | Restrictions: Follow Rust conventions, add mod.rs with docs | _Leverage: Rust test organization patterns | Success: Directory structure created, mod.rs files present, cargo test discovers structure | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n- [ ] 2. Create OperationBuilder fixture\n  - File: `core/tests/fixtures/operations.rs`\n  - Builder for creating PendingOp instances\n  - Methods: remap(), block(), combo(), pass(), build()\n  - Purpose: Reduce test setup boilerplate\n  - _Leverage: Builder pattern_\n  - _Requirements: 4.1, 4.3_\n  - _Prompt: Implement the task for spec test-organization, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer creating test utilities | Task: Create OperationBuilder in core/tests/fixtures/operations.rs | Restrictions: Builder pattern, chainable methods, clear API | _Leverage: PendingOp types | Success: Builder works for all operation types, reduces test LOC | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n- [ ] 3. Create script fixtures\n  - File: `core/tests/fixtures/scripts.rs`\n  - Common Rhai script snippets for testing\n  - Functions: minimal_script(), layer_script(), error_script()\n  - Purpose: Consistent test scripts\n  - _Leverage: Existing test scripts_\n  - _Requirements: 4.1_\n  - _Prompt: Implement the task for spec test-organization, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer creating test utilities | Task: Create script fixtures in core/tests/fixtures/scripts.rs | Restrictions: Cover common scenarios, valid and invalid scripts | _Leverage: Existing test scripts | Success: Fixtures cover testing needs, scripts are valid Rhai | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n- [ ] 4. Create TestEngine fixture\n  - File: `core/tests/fixtures/engine.rs`\n  - Wrapper for testing engine with mock dependencies\n  - Methods: new(), with_script(), process()\n  - Purpose: Simplify engine testing\n  - _Leverage: Existing mock patterns_\n  - _Requirements: 4.1, 4.2_\n  - _Prompt: Implement the task for spec test-organization, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer creating test utilities | Task: Create TestEngine fixture in core/tests/fixtures/engine.rs | Restrictions: Use mock dependencies, easy setup, proper cleanup | _Leverage: Existing mock patterns | Success: TestEngine simplifies engine tests, handles cleanup | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n## Phase 2: Split Validation Tests\n\n- [ ] 5. Split validation_integration.rs - conflict tests\n  - File: `core/tests/integration/validation/conflict_integration_tests.rs`\n  - Extract conflict-related tests from 27K file\n  - Use fixtures for setup\n  - Purpose: First validation test split\n  - _Leverage: OperationBuilder, existing tests_\n  - _Requirements: 1.1, 1.2_\n  - _Prompt: Implement the task for spec test-organization, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer splitting tests | Task: Extract conflict tests from validation_integration.rs to conflict_integration_tests.rs | Restrictions: Keep tests passing, use fixtures, < 500 LOC | _Leverage: OperationBuilder, existing tests | Success: Tests pass, file < 500 LOC, coverage maintained | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n- [ ] 6. Split validation_integration.rs - cycle tests\n  - File: `core/tests/integration/validation/cycle_integration_tests.rs`\n  - Extract cycle detection tests\n  - Purpose: Continue validation split\n  - _Leverage: Fixtures, existing tests_\n  - _Requirements: 1.1_\n  - _Prompt: Implement the task for spec test-organization, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer splitting tests | Task: Extract cycle tests from validation_integration.rs | Restrictions: Keep tests passing, < 500 LOC | _Leverage: Fixtures, existing tests | Success: Tests pass, organized by cycle scenarios | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n- [ ] 7. Split validation_integration.rs - remaining categories\n  - Files: `core/tests/integration/validation/{shadowing,safety,coverage,edge_case}_tests.rs`\n  - Extract remaining test categories\n  - Delete or minimize original file\n  - Purpose: Complete validation split\n  - _Leverage: Fixtures, pattern from previous tasks_\n  - _Requirements: 1.1, 1.4_\n  - _Prompt: Implement the task for spec test-organization, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer completing test split | Task: Extract remaining tests from validation_integration.rs | Restrictions: All tests passing, original file removed, < 500 LOC each | _Leverage: Pattern from previous splits | Success: All validation tests organized, original file gone | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n## Phase 3: Split Phase Tests\n\n- [ ] 8. Split phase_1_3_integration_test.rs - Phase 1 tests\n  - Files: `core/tests/integration/phases/phase1_{basic_remap,block}_tests.rs`\n  - Extract Phase 1 functionality tests\n  - Purpose: First phase test split\n  - _Leverage: Fixtures, existing tests_\n  - _Requirements: 1.1_\n  - _Prompt: Implement the task for spec test-organization, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer splitting tests | Task: Extract Phase 1 tests from phase_1_3_integration_test.rs | Restrictions: Keep tests passing, < 600 LOC per file | _Leverage: Fixtures, existing tests | Success: Phase 1 tests organized, passing | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n- [ ] 9. Split phase_1_3_integration_test.rs - Phase 2 tests\n  - Files: `core/tests/integration/phases/phase2_{layer,modifier}_tests.rs`\n  - Extract Phase 2 functionality tests\n  - Purpose: Continue phase split\n  - _Leverage: Fixtures, pattern from previous_\n  - _Requirements: 1.1_\n  - _Prompt: Implement the task for spec test-organization, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer splitting tests | Task: Extract Phase 2 tests from phase_1_3_integration_test.rs | Restrictions: Keep tests passing, < 700 LOC per file | _Leverage: Pattern from Phase 1 split | Success: Phase 2 tests organized, passing | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n- [ ] 10. Split phase_1_3_integration_test.rs - Phase 3 and remaining\n  - Files: `core/tests/integration/phases/phase3_{combo,timing}_tests.rs`, `regression_tests.rs`\n  - Extract Phase 3 and cleanup original\n  - Purpose: Complete phase split\n  - _Leverage: Fixtures, established pattern_\n  - _Requirements: 1.1_\n  - _Prompt: Implement the task for spec test-organization, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer completing test split | Task: Extract Phase 3 and remaining tests, remove original file | Restrictions: All tests passing, original file removed | _Leverage: Established pattern | Success: All phase tests organized, original file gone | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n## Phase 4: Inline Test Extraction\n\n- [ ] 11. Extract inline tests from validation modules\n  - Files: Move tests from `validation/*.rs` to `tests/unit/validation/`\n  - Add #[cfg(test)] helpers as needed\n  - Purpose: Clean source files\n  - _Leverage: Test helpers_\n  - _Requirements: 3.1, 3.2, 3.3_\n  - _Prompt: Implement the task for spec test-organization, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer extracting tests | Task: Move inline tests from validation modules to tests/unit/validation/ | Restrictions: Expose helpers if needed, maintain coverage, keep < 100 LOC inline | _Leverage: cfg(test) patterns | Success: Source files cleaner, tests still pass | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n- [ ] 12. Extract inline tests from engine modules\n  - Files: Move tests from `engine/*.rs` to `tests/unit/engine/`\n  - Preserve internal behavior tests inline\n  - Purpose: Clean source files\n  - _Leverage: Test helpers_\n  - _Requirements: 3.1, 3.4_\n  - _Prompt: Implement the task for spec test-organization, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer extracting tests | Task: Move inline tests from engine modules to tests/unit/engine/ | Restrictions: Keep truly internal tests inline, extract module behavior tests | _Leverage: cfg(test) patterns | Success: Engine source cleaner, tests organized | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n- [ ] 13. Extract inline tests from scripting modules\n  - Files: Move tests from `scripting/*.rs` to `tests/unit/scripting/`\n  - Purpose: Clean source files\n  - _Leverage: Test helpers_\n  - _Requirements: 3.1_\n  - _Prompt: Implement the task for spec test-organization, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer extracting tests | Task: Move inline tests from scripting modules to tests/unit/scripting/ | Restrictions: Maintain coverage, extract binding tests | _Leverage: cfg(test) patterns | Success: Scripting source cleaner, tests organized | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n## Phase 5: Documentation & CI\n\n- [ ] 14. Create test README documentation\n  - File: `core/tests/README.md`\n  - Document test organization strategy\n  - Explain where to add new tests\n  - List naming conventions\n  - Purpose: Developer guidance\n  - _Leverage: Implementation details_\n  - _Requirements: 5.1, 5.2, 5.4_\n  - _Prompt: Implement the task for spec test-organization, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Technical Writer | Task: Create test README in core/tests/README.md | Restrictions: Cover organization, naming, where to add tests | _Leverage: New test structure | Success: README is helpful, developers can find right location | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n- [ ] 15. Update CI to run test categories\n  - File: `.github/workflows/ci.yml`\n  - Add separate jobs for unit/integration/e2e\n  - Configure parallel execution\n  - Purpose: CI optimization\n  - _Leverage: GitHub Actions, cargo nextest_\n  - _Requirements: Non-functional (performance)_\n  - _Prompt: Implement the task for spec test-organization, first run spec-workflow-guide to get the workflow guide then implement the task: Role: DevOps Engineer | Task: Update CI workflow to run test categories separately | Restrictions: Unit tests fast, integration can be slower, e2e optional | _Leverage: GitHub Actions, cargo nextest | Success: CI runs tests efficiently, clear feedback per category | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n- [ ] 16. Verify coverage maintained\n  - Run coverage before and after reorganization\n  - Ensure no coverage regression\n  - Add coverage thresholds to CI\n  - Purpose: Quality assurance\n  - _Leverage: cargo-llvm-cov_\n  - _Requirements: Non-functional (reliability)_\n  - _Prompt: Implement the task for spec test-organization, first run spec-workflow-guide to get the workflow guide then implement the task: Role: QA Developer | Task: Verify test coverage maintained after reorganization | Restrictions: No coverage regression, add CI thresholds | _Leverage: cargo-llvm-cov | Success: Coverage same or better, CI enforces threshold | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n",
  "fileStats": {
    "size": 13550,
    "lines": 149,
    "lastModified": "2025-12-03T13:05:53.056Z"
  },
  "comments": []
}