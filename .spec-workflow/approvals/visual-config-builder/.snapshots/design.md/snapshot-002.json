{
  "id": "snapshot_1767426118529_3esb9jv2m",
  "approvalId": "approval_1767022113108_txpp1dnms",
  "approvalTitle": "Visual Configuration Builder - Design",
  "version": 2,
  "timestamp": "2026-01-03T07:41:58.529Z",
  "trigger": "approved",
  "status": "pending",
  "content": "# Design Document\n\n## Architecture\n\n```\nVisual UI → State Manager → Rhai Generator → Validation → Daemon\n   ↓            ↓               ↓              ↓\nDrag-Drop   ConfigState   generateRhai()  WasmCore\n```\n\n## Components\n\n### 1. VisualConfigBuilder (keyrx_ui/src/pages/VisualConfigBuilder.tsx)\n- Main page with keyboard, layers panel, modifiers panel, code preview\n- DndContext provider from @dnd-kit\n\n### 2. VirtualKeyboard (keyrx_ui/src/components/VirtualKeyboard.tsx)\n- On-screen keyboard with draggable keys\n- Highlight mapped keys with color coding\n\n**UI Layout:**\n```\n+---------------------------------------------------------------+\n| Layer: base                        [+ Add Layer]              |\n+---------------------------------------------------------------+\n| [Esc] [F1] [F2] [F3] ... [F12]                               |\n| [`] [1] [2] ... [0] [-] [=] [Backspace]                      |\n| [Tab] [Q→A] [W] [E] ... [P] [[] []]          ← mapped        |\n| [Caps] [A] [S] [D] ... [;] ['] [Enter]                       |\n| [Shift] [Z] [X] [C] ... [/] [Shift]                          |\n+---------------------------------------------------------------+\n| Drag from: Source Key     Drop on: Target Key                |\n+---------------------------------------------------------------+\n```\n\n### 3. LayerPanel (keyrx_ui/src/components/LayerPanel.tsx)\n- List of layers with drag-to-reorder\n- Add/delete/rename layer buttons\n\n### 4. ModifierPanel (keyrx_ui/src/components/ModifierPanel.tsx)\n- List of modifiers/locks\n- Drag key to panel to assign\n\n### 5. CodePreview (keyrx_ui/src/components/CodePreview.tsx)\n- Monaco editor showing generated Rhai code (read-only)\n- Copy button\n\n### 6. generateRhai() (keyrx_ui/src/utils/rhaiGenerator.ts)\n- Convert ConfigState to Rhai syntax\n- Format with proper indentation\n\n## Data Models\n\n```typescript\ninterface ConfigState {\n  layers: Layer[];\n  modifiers: Modifier[];\n  locks: Lock[];\n}\n\ninterface Layer {\n  id: string;\n  name: string;\n  mappings: Mapping[];\n}\n\ninterface Mapping {\n  sourceKey: string;  // \"KEY_Q\"\n  targetKey: string;  // \"KEY_A\"\n  type: 'simple' | 'modifier_trigger' | 'layer_switch';\n}\n```\n\n## Dependencies\n\n- `@dnd-kit/core@^6.1.0`\n- `@dnd-kit/sortable@^8.0.0`\n\n## Sources\n\n- [15 Drag and Drop UI Design Tips](https://bricxlabs.com/blogs/drag-and-drop-ui)\n- [Best Practices for Drag-and-Drop Workflow UI](https://latenode.com/blog/best-practices-for-drag-and-drop-workflow-ui)\n",
  "fileStats": {
    "size": 2467,
    "lines": 83,
    "lastModified": "2025-12-29T15:23:55.898Z"
  },
  "comments": []
}