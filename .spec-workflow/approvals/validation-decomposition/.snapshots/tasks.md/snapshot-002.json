{
  "id": "snapshot_1764768197066_bbdz5saxg",
  "approvalId": "approval_1764767191901_7lry53my6",
  "approvalTitle": "Validation Decomposition - Tasks",
  "version": 2,
  "timestamp": "2025-12-03T13:23:17.066Z",
  "trigger": "approved",
  "status": "pending",
  "content": "# Tasks Document\n\n## Phase 1: Infrastructure\n\n- [ ] 1. Create Detector trait and common types\n  - File: `core/src/validation/detectors/mod.rs`\n  - Define `Detector` trait with name(), detect(), is_skippable()\n  - Create `DetectorContext`, `DetectorResult`, `DetectorStats` types\n  - Purpose: Common interface for all detectors\n  - _Leverage: Rust trait patterns_\n  - _Requirements: 1.4, 2.4, 3.4_\n  - _Prompt: Implement the task for spec validation-decomposition, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer with trait design expertise | Task: Create Detector trait and supporting types in core/src/validation/detectors/mod.rs | Restrictions: Trait must be object-safe, support Send+Sync, include timing stats | _Leverage: Rust trait patterns | Success: Trait compiles, types are ergonomic, supports async if needed | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n- [ ] 2. Create ValidationIssue and Severity types\n  - File: `core/src/validation/common/issue.rs`\n  - Define `ValidationIssue` with severity, detector, message, locations\n  - Create `Severity` enum (Error, Warning, Info)\n  - Add serialization support\n  - Purpose: Unified issue reporting\n  - _Leverage: Existing error types_\n  - _Requirements: 1.3, 2.2, 3.2_\n  - _Prompt: Implement the task for spec validation-decomposition, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer creating error types | Task: Create ValidationIssue and Severity in core/src/validation/common/issue.rs | Restrictions: Serde serializable, include source locations, clear Display impl | _Leverage: Existing validation error patterns | Success: Types compile, serialize correctly, Display is informative | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n- [ ] 3. Create OperationVisitor utility\n  - File: `core/src/validation/common/visitor.rs`\n  - Define `OperationVisitor` trait\n  - Implement `visit_all()` helper function\n  - Purpose: Shared operation traversal\n  - _Leverage: Visitor pattern_\n  - _Requirements: 5.1_\n  - _Prompt: Implement the task for spec validation-decomposition, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer implementing visitor pattern | Task: Create OperationVisitor in core/src/validation/common/visitor.rs | Restrictions: Handle all PendingOp variants, efficient traversal | _Leverage: Visitor pattern, PendingOp type | Success: Visitor works with all operations, reusable by detectors | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n## Phase 2: Detector Extraction\n\n- [ ] 4. Extract ConflictDetector\n  - File: `core/src/validation/detectors/conflicts.rs`\n  - Move remap/block conflict detection from original conflicts.rs\n  - Implement Detector trait\n  - Build keyâ†’operations map for O(n) detection\n  - Purpose: Isolated conflict detection\n  - _Leverage: Original conflicts.rs logic_\n  - _Requirements: 1.1, 1.2, 1.3, 1.4_\n  - _Prompt: Implement the task for spec validation-decomposition, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer extracting module | Task: Extract ConflictDetector from conflicts.rs into core/src/validation/detectors/conflicts.rs | Restrictions: Preserve existing behavior, implement Detector trait, O(n) complexity | _Leverage: Current conflict detection in conflicts.rs | Success: ConflictDetector works identically, < 300 LOC, tests pass | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n- [ ] 5. Extract ShadowingDetector\n  - File: `core/src/validation/detectors/shadowing.rs`\n  - Move combo shadowing detection from original conflicts.rs\n  - Implement Detector trait with is_skippable() = true\n  - Purpose: Isolated shadowing detection\n  - _Leverage: Original shadowing logic_\n  - _Requirements: 2.1, 2.2, 2.3, 2.4_\n  - _Prompt: Implement the task for spec validation-decomposition, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer extracting module | Task: Extract ShadowingDetector from conflicts.rs into core/src/validation/detectors/shadowing.rs | Restrictions: Preserve existing behavior, mark as skippable, handle key ordering | _Leverage: Current shadowing detection | Success: ShadowingDetector works identically, skippable flag works | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n- [ ] 6. Extract CycleDetector\n  - File: `core/src/validation/detectors/cycles.rs`\n  - Move circular dependency detection from original conflicts.rs\n  - Implement DFS-based cycle detection\n  - Report full cycle paths\n  - Purpose: Isolated cycle detection\n  - _Leverage: Original cycle detection, graph algorithms_\n  - _Requirements: 3.1, 3.2, 3.3, 3.4_\n  - _Prompt: Implement the task for spec validation-decomposition, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer with graph algorithm expertise | Task: Extract CycleDetector from conflicts.rs into core/src/validation/detectors/cycles.rs | Restrictions: O(V+E) complexity, report full paths, use DFS with coloring | _Leverage: Current cycle detection, Tarjan's algorithm | Success: CycleDetector finds all cycles, reports paths, efficient | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n## Phase 3: Integration\n\n- [ ] 7. Create DetectorOrchestrator\n  - File: `core/src/validation/orchestrator.rs`\n  - Register and run all detectors in sequence\n  - Aggregate results into ValidationReport\n  - Support skipping detectors\n  - Purpose: Detector coordination\n  - _Leverage: Detector trait_\n  - _Requirements: 5.1_\n  - _Prompt: Implement the task for spec validation-decomposition, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer creating orchestrator | Task: Create DetectorOrchestrator in core/src/validation/orchestrator.rs | Restrictions: Run detectors in order, aggregate results, support skip flags | _Leverage: Detector trait, existing ValidationEngine | Success: Orchestrator runs all detectors, aggregates correctly | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n- [ ] 8. Update ValidationEngine to use orchestrator\n  - File: `core/src/validation/engine.rs`\n  - Replace inline conflict detection with orchestrator\n  - Maintain backward-compatible API\n  - Purpose: Integration with new architecture\n  - _Leverage: DetectorOrchestrator_\n  - _Requirements: Non-functional (compatibility)_\n  - _Prompt: Implement the task for spec validation-decomposition, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer integrating components | Task: Update ValidationEngine to use DetectorOrchestrator | Restrictions: Maintain backward compatibility, same public API, same behavior | _Leverage: DetectorOrchestrator, existing engine.rs | Success: Engine uses new detectors, all tests pass, API unchanged | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n- [ ] 9. Extract test helpers\n  - File: `core/src/validation/common/test_helpers.rs`\n  - Create operation builders for tests\n  - Add assertion helpers for issues\n  - Purpose: Shared test utilities\n  - _Leverage: Existing test patterns_\n  - _Requirements: 4.2_\n  - _Prompt: Implement the task for spec validation-decomposition, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Test Developer | Task: Create test helpers in core/src/validation/common/test_helpers.rs | Restrictions: Builder pattern for operations, assertion helpers, #[cfg(test)] | _Leverage: Existing test patterns in conflicts.rs | Success: Helpers reduce test boilerplate, clear API | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n## Phase 4: Test Migration\n\n- [ ] 10. Move conflict tests to dedicated file\n  - File: `core/src/validation/tests/conflict_tests.rs`\n  - Extract ~150 conflict-related tests from conflicts.rs\n  - Use test helpers\n  - Purpose: Test organization\n  - _Leverage: Test helpers, existing tests_\n  - _Requirements: 4.1, 4.3_\n  - _Prompt: Implement the task for spec validation-decomposition, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Test Developer | Task: Move conflict tests to core/src/validation/tests/conflict_tests.rs | Restrictions: All tests must pass, use new test helpers, organize by scenario | _Leverage: Existing inline tests, test_helpers | Success: All conflict tests moved, passing, well-organized | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n- [ ] 11. Move shadowing tests to dedicated file\n  - File: `core/src/validation/tests/shadowing_tests.rs`\n  - Extract shadowing-related tests\n  - Use test helpers\n  - Purpose: Test organization\n  - _Leverage: Test helpers, existing tests_\n  - _Requirements: 4.1, 4.3_\n  - _Prompt: Implement the task for spec validation-decomposition, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Test Developer | Task: Move shadowing tests to core/src/validation/tests/shadowing_tests.rs | Restrictions: All tests must pass, use new test helpers | _Leverage: Existing inline tests | Success: All shadowing tests moved, passing | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n- [ ] 12. Move cycle tests to dedicated file\n  - File: `core/src/validation/tests/cycle_tests.rs`\n  - Extract cycle detection tests\n  - Add edge cases for complex cycles\n  - Purpose: Test organization\n  - _Leverage: Test helpers, existing tests_\n  - _Requirements: 4.1, 4.3_\n  - _Prompt: Implement the task for spec validation-decomposition, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Test Developer | Task: Move cycle tests to core/src/validation/tests/cycle_tests.rs | Restrictions: All tests must pass, add complex cycle cases | _Leverage: Existing inline tests | Success: All cycle tests moved, passing, edge cases covered | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n## Phase 5: Cleanup\n\n- [ ] 13. Remove original conflicts.rs\n  - Files: `core/src/validation/conflicts.rs` (delete or minimize)\n  - Replace with re-exports from new modules\n  - Update mod.rs\n  - Purpose: Complete migration\n  - _Leverage: New module structure_\n  - _Requirements: Non-functional (cleanup)_\n  - _Prompt: Implement the task for spec validation-decomposition, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer completing cleanup | Task: Remove or minimize original conflicts.rs, update module structure | Restrictions: All imports must resolve, no dead code, clean module tree | _Leverage: New detector modules | Success: Old file removed, imports work, no warnings | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n- [ ] 14. Verify all existing behavior preserved\n  - Files: Run full test suite, integration tests\n  - Compare validation output before/after\n  - Purpose: Regression verification\n  - _Leverage: Existing test suite_\n  - _Requirements: Non-functional (reliability)_\n  - _Prompt: Implement the task for spec validation-decomposition, first run spec-workflow-guide to get the workflow guide then implement the task: Role: QA Developer | Task: Verify all validation behavior preserved through full test suite | Restrictions: No behavior changes, same outputs, same error messages | _Leverage: Full test suite, integration tests | Success: All tests pass, no regressions detected | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n- [ ] 15. Add detector documentation\n  - File: `docs/validation-architecture.md`\n  - Document detector pattern\n  - Explain how to add new detectors\n  - Purpose: Developer documentation\n  - _Leverage: Implementation details_\n  - _Requirements: Non-functional (usability)_\n  - _Prompt: Implement the task for spec validation-decomposition, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Technical Writer | Task: Create validation architecture documentation | Restrictions: Cover detector pattern, adding new detectors, module structure | _Leverage: Implementation from previous tasks | Success: Documentation complete, examples work | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n",
  "fileStats": {
    "size": 13564,
    "lines": 150,
    "lastModified": "2025-12-03T12:59:43.382Z"
  },
  "comments": []
}