{
  "id": "snapshot_1765452225211_o3m7jl2e1",
  "approvalId": "approval_1765452225121_39jbbt00e",
  "approvalTitle": "Enhanced Validation - Tasks",
  "version": 1,
  "timestamp": "2025-12-11T11:23:45.211Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Tasks Document\n\n## Implementation Tasks\n\n- [ ] 1. Add `syn` dependency to Cargo.toml\n  - File: `core/Cargo.toml`\n  - Add `syn = { version = \"2.0\", features = [\"full\", \"parsing\", \"visit\"] }` to dependencies\n  - Purpose: Enable Rust AST parsing for FFI function signature extraction\n  - _Leverage: Existing dependency management in Cargo.toml_\n  - _Requirements: REQ-1_\n  - _Prompt: Implement the task for spec enhanced-validation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer specializing in build configuration | Task: Add syn crate dependency to core/Cargo.toml with appropriate features for AST parsing following requirement REQ-1 | Restrictions: Do not upgrade other dependencies, maintain compatibility with existing crates, use stable version | Success: Cargo.toml compiles successfully, syn crate is available with full parsing capabilities | Instructions: Mark this task as in-progress in tasks.md before starting. After completion, log the implementation with detailed artifacts using the log-implementation tool, then mark the task as completed in tasks.md_\n\n- [ ] 2. Create ParsedFunction data structures\n  - File: `core/tests/contract_adherence/parser.rs`\n  - Define `ParsedFunction`, `ParsedParam`, and `ParsedType` structs\n  - Purpose: Model extracted Rust function signatures\n  - _Leverage: None (new module)_\n  - _Requirements: REQ-1_\n  - _Prompt: Implement the task for spec enhanced-validation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer with expertise in data modeling and type systems | Task: Create data structures for representing parsed FFI functions following requirement REQ-1, modeling function signatures with parameters and types | Restrictions: Must support pointer types, mutability flags, and line number tracking, keep structs under 50 lines each | Success: Structs compile, derive Debug/Clone, support all FFI type variations | Instructions: Mark this task as in-progress in tasks.md before starting. After completion, log the implementation with detailed artifacts using the log-implementation tool, then mark the task as completed in tasks.md_\n\n- [ ] 3. Implement Rust AST parser using syn\n  - File: `core/tests/contract_adherence/parser.rs`\n  - Implement `parse_ffi_exports(file_path: &Path) -> Result<Vec<ParsedFunction>, syn::Error>`\n  - Extract `extern \"C\"` functions with #[no_mangle] attribute\n  - Purpose: Parse Rust source files and extract FFI function signatures\n  - _Leverage: syn crate for AST parsing_\n  - _Requirements: REQ-1_\n  - _Prompt: Implement the task for spec enhanced-validation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer with expertise in syn crate and AST manipulation | Task: Implement function to parse Rust files and extract extern C function signatures following requirement REQ-1, using syn to visit AST nodes and extract function details | Restrictions: Must handle syntax errors gracefully, extract complete signature information including line numbers, function under 50 lines | Success: Parser extracts all extern C functions with correct signatures, handles edge cases, provides detailed syn::Error on failure | Instructions: Mark this task as in-progress in tasks.md before starting. After completion, log the implementation with detailed artifacts using the log-implementation tool (include function signature, location, purpose), then mark the task as completed in tasks.md_\n\n- [ ] 4. Add unit tests for AST parser\n  - File: `core/tests/contract_adherence/parser_tests.rs`\n  - Test parsing of sample FFI functions with various signatures\n  - Test error handling for invalid Rust syntax\n  - Purpose: Ensure parser reliability\n  - _Leverage: None (new test module)_\n  - _Requirements: REQ-1_\n  - _Prompt: Implement the task for spec enhanced-validation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: QA Engineer with expertise in Rust unit testing | Task: Create comprehensive unit tests for the AST parser following requirement REQ-1, testing various function signatures and error scenarios | Restrictions: Test both success and failure cases, use inline Rust code strings for test inputs, maintain test isolation | Success: All parser functionality tested, edge cases covered, tests run independently | Instructions: Mark this task as in-progress in tasks.md before starting. After completion, log the implementation with detailed artifacts using the log-implementation tool, then mark the task as completed in tasks.md_\n\n- [ ] 5. Create type mapping module\n  - File: `core/tests/contract_adherence/type_mapper.rs`\n  - Implement `map_contract_to_rust(contract_type: &str) -> RustFfiType`\n  - Define type mapping rules (string â†’ *const c_char, etc.)\n  - Purpose: Map contract types to expected Rust FFI types\n  - _Leverage: TypeDefinition from core/src/ffi/contract.rs_\n  - _Requirements: REQ-3_\n  - _Prompt: Implement the task for spec enhanced-validation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer specializing in FFI and type systems | Task: Create type mapping module that converts contract type strings to Rust FFI types following requirement REQ-3, implementing all type mapping rules from the design | Restrictions: Must handle all contract types (string, int, bool, void, custom), return clear errors for unknown types, function under 50 lines | Success: All contract types map correctly to Rust FFI types, unknown types return error, mappings are consistent | Instructions: Mark this task as in-progress in tasks.md before starting. After completion, log the implementation with detailed artifacts using the log-implementation tool (include type mapping table, function details), then mark the task as completed in tasks.md_\n\n- [ ] 6. Implement type validation logic\n  - File: `core/tests/contract_adherence/type_mapper.rs`\n  - Implement `validate_type_match(contract: &str, rust: &ParsedType) -> Result<(), TypeMismatch>`\n  - Compare parsed Rust types against expected contract types\n  - Purpose: Validate type compatibility\n  - _Leverage: RustFfiType from type_mapper.rs_\n  - _Requirements: REQ-2, REQ-3_\n  - _Prompt: Implement the task for spec enhanced-validation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer with expertise in type checking and validation | Task: Implement type validation logic that compares contract types with parsed Rust types following requirements REQ-2 and REQ-3, handling pointer variations and custom types | Restrictions: Must handle pointer mutability, null safety, and JSON serialization types, provide clear mismatch messages, function under 50 lines | Success: Type matching works correctly for all FFI patterns, mismatches are detected accurately, error messages are actionable | Instructions: Mark this task as in-progress in tasks.md before starting. After completion, log the implementation with detailed artifacts using the log-implementation tool (include function signature, validation rules), then mark the task as completed in tasks.md_\n\n- [ ] 7. Add unit tests for type mapper\n  - File: `core/tests/contract_adherence/type_mapper_tests.rs`\n  - Test all type mapping rules\n  - Test type validation with matching and mismatched types\n  - Purpose: Ensure type mapping reliability\n  - _Leverage: None (new test module)_\n  - _Requirements: REQ-3_\n  - _Prompt: Implement the task for spec enhanced-validation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: QA Engineer with expertise in Rust testing and type systems | Task: Create unit tests for type mapper following requirement REQ-3, testing all type mappings and validation logic with various scenarios | Restrictions: Test all primitive types, custom types, and pointer variations, test both matching and mismatching types, maintain test clarity | Success: All type mappings tested, validation logic verified, edge cases covered | Instructions: Mark this task as in-progress in tasks.md before starting. After completion, log the implementation with detailed artifacts using the log-implementation tool, then mark the task as completed in tasks.md_\n\n- [ ] 8. Create ValidationError enum\n  - File: `core/tests/contract_adherence/validator.rs`\n  - Define `ValidationError` enum with variants for all error types\n  - Add `FileLocation` struct for tracking error locations\n  - Purpose: Model validation errors with rich context\n  - _Leverage: None (new module)_\n  - _Requirements: REQ-4_\n  - _Prompt: Implement the task for spec enhanced-validation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer specializing in error handling and type design | Task: Create ValidationError enum following requirement REQ-4, including variants for missing functions, parameter mismatches, type mismatches, and return type errors | Restrictions: Must include file locations, derive Debug/Clone, support rich error context, enum under 50 lines | Success: Error types cover all validation scenarios, include actionable context, compile without errors | Instructions: Mark this task as in-progress in tasks.md before starting. After completion, log the implementation with detailed artifacts using the log-implementation tool, then mark the task as completed in tasks.md_\n\n- [ ] 9. Implement signature validator\n  - File: `core/tests/contract_adherence/validator.rs`\n  - Implement `validate_function(contract: &FunctionContract, parsed: &ParsedFunction) -> Result<(), ValidationError>`\n  - Check parameter counts, parameter types, and return types\n  - Purpose: Compare contract functions against parsed Rust signatures\n  - _Leverage: Type mapper for type validation, ParsedFunction and FunctionContract structs_\n  - _Requirements: REQ-2_\n  - _Prompt: Implement the task for spec enhanced-validation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer with expertise in validation logic and error handling | Task: Implement function signature validator following requirement REQ-2, comparing contract definitions against parsed Rust functions and detecting all types of mismatches | Restrictions: Must validate parameter count, each parameter type, and return type, handle error pointer parameter, function under 50 lines | Success: All signature mismatches detected, error pointer handled correctly, validation is thorough and accurate | Instructions: Mark this task as in-progress in tasks.md before starting. After completion, log the implementation with detailed artifacts using the log-implementation tool (include function signature, validation checks), then mark the task as completed in tasks.md_\n\n- [ ] 10. Implement batch validation\n  - File: `core/tests/contract_adherence/validator.rs`\n  - Implement `validate_all_functions(contracts: &[FfiContract], parsed: &[ParsedFunction]) -> ValidationReport`\n  - Collect all validation errors instead of failing fast\n  - Detect missing functions and uncontracted functions\n  - Purpose: Validate all contracts in one pass\n  - _Leverage: validate_function for individual checks_\n  - _Requirements: REQ-2, REQ-5_\n  - _Prompt: Implement the task for spec enhanced-validation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer with expertise in batch processing and validation pipelines | Task: Implement batch validation following requirements REQ-2 and REQ-5, validating all contract functions and detecting missing/uncontracted functions | Restrictions: Must collect all errors not fail fast, detect bidirectional mismatches (contract without impl, impl without contract), function under 50 lines | Success: All functions validated in single pass, all errors collected, missing and uncontracted functions detected | Instructions: Mark this task as in-progress in tasks.md before starting. After completion, log the implementation with detailed artifacts using the log-implementation tool (include function details, validation logic), then mark the task as completed in tasks.md_\n\n- [ ] 11. Add unit tests for validator\n  - File: `core/tests/contract_adherence/validator_tests.rs`\n  - Test validation with matching and mismatched signatures\n  - Test missing function detection\n  - Test uncontracted function detection\n  - Purpose: Ensure validator reliability\n  - _Leverage: None (new test module)_\n  - _Requirements: REQ-2, REQ-5_\n  - _Prompt: Implement the task for spec enhanced-validation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: QA Engineer with expertise in validation testing | Task: Create comprehensive unit tests for validator following requirements REQ-2 and REQ-5, testing all validation scenarios including matches, mismatches, and missing functions | Restrictions: Test both positive and negative cases, use clear test data, maintain test independence | Success: All validation logic tested, edge cases covered, tests provide clear failure messages | Instructions: Mark this task as in-progress in tasks.md before starting. After completion, log the implementation with detailed artifacts using the log-implementation tool, then mark the task as completed in tasks.md_\n\n- [ ] 12. Create error reporter module\n  - File: `core/tests/contract_adherence/reporter.rs`\n  - Implement `generate_full_report(errors: Vec<ValidationError>) -> String`\n  - Format errors with file locations, expected vs found, and fix suggestions\n  - Purpose: Generate human-readable error reports\n  - _Leverage: ValidationError enum_\n  - _Requirements: REQ-4_\n  - _Prompt: Implement the task for spec enhanced-validation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer specializing in error reporting and user experience | Task: Create error reporter following requirement REQ-4, generating comprehensive, actionable error messages with file locations and fix suggestions | Restrictions: Must include all error context, provide clear formatting, suggest fixes for common errors, function under 50 lines | Success: Error reports are clear and actionable, include all relevant context, easy to understand and follow | Instructions: Mark this task as in-progress in tasks.md before starting. After completion, log the implementation with detailed artifacts using the log-implementation tool (include function signature, report format), then mark the task as completed in tasks.md_\n\n- [ ] 13. Integrate enhanced validation into contract_adherence test\n  - File: `core/tests/contract_adherence.rs`\n  - Replace simple string matching with AST-based validation\n  - Load contracts, parse exports.rs, run validation, report errors\n  - Purpose: Complete the enhanced validation feature\n  - _Leverage: All modules created in previous tasks_\n  - _Requirements: All_\n  - _Prompt: Implement the task for spec enhanced-validation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer with expertise in test infrastructure and integration | Task: Integrate all enhanced validation components into the existing contract_adherence test, replacing string matching with comprehensive AST validation | Restrictions: Must maintain existing test structure, fail test on validation errors, provide clear output, test function under 50 lines | Success: Test uses AST parsing, validates all contracts, provides detailed errors on mismatch, passes with current correct code | Instructions: Mark this task as in-progress in tasks.md before starting. After completion, log the implementation with detailed artifacts using the log-implementation tool (include integration points, test flow), then mark the task as completed in tasks.md_\n\n- [ ] 14. Run integration test with real contracts\n  - File: `core/tests/contract_adherence.rs`\n  - Run test against all existing contracts\n  - Fix any discovered issues in FFI code\n  - Purpose: Validate that enhanced validation works end-to-end\n  - _Leverage: Existing contracts in core/src/ffi/contracts/_\n  - _Requirements: All_\n  - _Prompt: Implement the task for spec enhanced-validation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: QA Engineer and Rust Developer | Task: Run enhanced validation test against real contracts, identify and fix any mismatches discovered | Restrictions: Must fix real FFI code issues, not skip validation errors, document all changes made | Success: Test passes with all real contracts, any discovered issues fixed, validation proves effective | Instructions: Mark this task as in-progress in tasks.md before starting. After completion, log the implementation with detailed artifacts using the log-implementation tool (include issues found, fixes applied), then mark the task as completed in tasks.md_\n\n- [ ] 15. Add documentation and examples\n  - Files: `core/tests/contract_adherence/README.md`, inline code docs\n  - Document how the enhanced validation works\n  - Add examples of common errors and fixes\n  - Purpose: Enable developers to understand and use the validation\n  - _Leverage: None (new documentation)_\n  - _Requirements: All_\n  - _Prompt: Implement the task for spec enhanced-validation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Technical Writer with Rust development experience | Task: Create comprehensive documentation for enhanced validation system, including architecture overview, type mapping rules, and common error fixes | Restrictions: Keep documentation concise and actionable, provide clear examples, include migration guide from old system | Success: Documentation is complete and clear, examples are helpful, developers can understand and use the system | Instructions: Mark this task as in-progress in tasks.md before starting. After completion, log the implementation with detailed artifacts using the log-implementation tool, then mark the task as completed in tasks.md_\n",
  "fileStats": {
    "size": 18106,
    "lines": 139,
    "lastModified": "2025-12-11T11:20:55.755Z"
  },
  "comments": []
}