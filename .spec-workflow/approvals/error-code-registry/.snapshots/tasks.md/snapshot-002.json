{
  "id": "snapshot_1764768915516_a0ix8hhae",
  "approvalId": "approval_1764768820315_sbryuaak7",
  "approvalTitle": "Error Code Registry Tasks (18 tasks)",
  "version": 2,
  "timestamp": "2025-12-03T13:35:15.516Z",
  "trigger": "approved",
  "status": "pending",
  "content": "# Tasks Document\n\n## Phase 1: Core Types\n\n- [ ] 1. Create ErrorCode type\n  - File: `core/src/errors/code.rs`\n  - Define ErrorCode with category and number\n  - Implement Display as KRX-XXXX\n  - Purpose: Unique error identifier\n  - _Leverage: Rust type patterns_\n  - _Requirements: 1.1, 1.3_\n  - _Prompt: Implement the task for spec error-code-registry, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer creating types | Task: Create ErrorCode with KRX-XXXX format | Restrictions: Category prefix, 3-digit number, Display impl | _Leverage: Type patterns | Success: ErrorCode displays correctly | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n- [ ] 2. Create ErrorCategory enum\n  - File: `core/src/errors/category.rs`\n  - Define categories: Config, Runtime, Driver, Validation, Ffi, Internal\n  - Assign number ranges to each category\n  - Purpose: Error categorization\n  - _Leverage: Enum patterns_\n  - _Requirements: 4.1, 4.2_\n  - _Prompt: Implement the task for spec error-code-registry, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer creating enums | Task: Create ErrorCategory with prefix and range | Restrictions: Clear prefixes, no overlap in ranges | _Leverage: Enum patterns | Success: Categories cover all error types | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n- [ ] 3. Create ErrorDef type\n  - File: `core/src/errors/definition.rs`\n  - Define error with code, template, hint, severity\n  - Add message formatting with args\n  - Purpose: Error definition\n  - _Leverage: Template patterns_\n  - _Requirements: 2.2, 3.1, 3.2_\n  - _Prompt: Implement the task for spec error-code-registry, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer creating definitions | Task: Create ErrorDef with message templating | Restrictions: Template args, hint support, severity | _Leverage: Template patterns | Success: Definitions format correctly | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n- [ ] 4. Create KeyrxError type\n  - File: `core/src/errors/error.rs`\n  - Implement std::error::Error\n  - Add context and source chaining\n  - JSON serialization\n  - Purpose: Runtime error type\n  - _Leverage: thiserror_\n  - _Requirements: 1.3, 1.4, 3.3_\n  - _Prompt: Implement the task for spec error-code-registry, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer creating errors | Task: Create KeyrxError with thiserror | Restrictions: Error trait, context chain, JSON output | _Leverage: thiserror | Success: Errors chain and serialize | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n## Phase 2: Registry Infrastructure\n\n- [ ] 5. Create define_errors! macro\n  - File: `core/src/errors/macros.rs`\n  - Macro for defining error sets\n  - Compile-time duplicate detection\n  - Purpose: Error definition convenience\n  - _Leverage: Rust macro patterns_\n  - _Requirements: 2.1, 2.2_\n  - _Prompt: Implement the task for spec error-code-registry, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Macro Developer | Task: Create define_errors! macro with duplicate detection | Restrictions: Compile-time checks, clear syntax | _Leverage: Macro patterns | Success: Macro defines errors cleanly | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n- [ ] 6. Create keyrx_err! and bail_keyrx! macros\n  - File: `core/src/errors/macros.rs`\n  - Error creation macros\n  - Context injection\n  - Purpose: Convenient error creation\n  - _Leverage: anyhow patterns_\n  - _Requirements: 3.3_\n  - _Prompt: Implement the task for spec error-code-registry, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Macro Developer | Task: Create keyrx_err! and bail_keyrx! macros | Restrictions: Ergonomic, context support | _Leverage: anyhow patterns | Success: Errors easy to create | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n- [ ] 7. Create ErrorRegistry\n  - File: `core/src/errors/registry.rs`\n  - Static registry of all errors\n  - Lookup by code and category\n  - Purpose: Central error repository\n  - _Leverage: Static patterns_\n  - _Requirements: 2.1, 4.3_\n  - _Prompt: Implement the task for spec error-code-registry, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer creating registry | Task: Create ErrorRegistry with static storage | Restrictions: Thread-safe, efficient lookup | _Leverage: Static patterns | Success: Registry provides all errors | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n## Phase 3: Define Errors\n\n- [ ] 8. Define Config errors (1xxx)\n  - File: `core/src/errors/config.rs`\n  - Config loading, parsing, validation errors\n  - Purpose: Configuration error codes\n  - _Leverage: define_errors! macro_\n  - _Requirements: 2.2, 4.2_\n  - _Prompt: Implement the task for spec error-code-registry, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer defining errors | Task: Define Config category errors (KRX-C1xx) | Restrictions: Cover all config failures, helpful hints | _Leverage: define_errors! | Success: Config errors comprehensive | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n- [ ] 9. Define Runtime errors (2xxx)\n  - File: `core/src/errors/runtime.rs`\n  - Engine, processing, state errors\n  - Purpose: Runtime error codes\n  - _Leverage: define_errors! macro_\n  - _Requirements: 2.2, 4.2_\n  - _Prompt: Implement the task for spec error-code-registry, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer defining errors | Task: Define Runtime category errors (KRX-R2xx) | Restrictions: Cover all runtime failures, hints | _Leverage: define_errors! | Success: Runtime errors comprehensive | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n- [ ] 10. Define Driver errors (3xxx)\n  - File: `core/src/errors/driver.rs`\n  - Windows and Linux driver errors\n  - Purpose: Driver error codes\n  - _Leverage: define_errors! macro_\n  - _Requirements: 2.2, 4.2_\n  - _Prompt: Implement the task for spec error-code-registry, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer defining errors | Task: Define Driver category errors (KRX-D3xx) | Restrictions: Platform-specific hints, cover all drivers | _Leverage: define_errors! | Success: Driver errors comprehensive | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n- [ ] 11. Define Validation errors (4xxx)\n  - File: `core/src/errors/validation.rs`\n  - Config validation, conflict detection errors\n  - Purpose: Validation error codes\n  - _Leverage: define_errors! macro_\n  - _Requirements: 2.2, 4.2_\n  - _Prompt: Implement the task for spec error-code-registry, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer defining errors | Task: Define Validation category errors (KRX-V4xx) | Restrictions: Cover all validation failures | _Leverage: define_errors! | Success: Validation errors comprehensive | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n## Phase 4: Migration\n\n- [ ] 12. Replace println errors in CLI\n  - Files: `core/src/bin/keyrx.rs`, CLI modules\n  - Replace raw println with keyrx_err!\n  - Purpose: Consistent CLI errors\n  - _Leverage: keyrx_err! macro_\n  - _Requirements: 1.1, 1.3_\n  - _Prompt: Implement the task for spec error-code-registry, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer migrating errors | Task: Replace println errors in CLI with keyrx_err! | Restrictions: All user-facing errors, preserve context | _Leverage: keyrx_err! | Success: CLI uses error codes | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n- [ ] 13. Replace anyhow errors in core\n  - Files: Core engine and processing\n  - Migrate anyhow::anyhow! to keyrx_err!\n  - Purpose: Structured core errors\n  - _Leverage: keyrx_err! macro_\n  - _Requirements: 1.1, 3.3_\n  - _Prompt: Implement the task for spec error-code-registry, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer migrating errors | Task: Replace anyhow! in core with keyrx_err! | Restrictions: Preserve error context, maintain chains | _Leverage: keyrx_err! | Success: Core uses error codes | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n- [ ] 14. Update FFI error exports\n  - File: `core/src/ffi/exports_*.rs`\n  - Export error codes through FFI\n  - Purpose: Flutter error access\n  - _Leverage: FFI patterns_\n  - _Requirements: 1.3_\n  - _Prompt: Implement the task for spec error-code-registry, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer updating FFI | Task: Update FFI to export error codes | Restrictions: C-compatible, include hints | _Leverage: FFI patterns | Success: Flutter receives error codes | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n## Phase 5: Documentation\n\n- [ ] 15. Create ErrorDocGenerator\n  - File: `core/src/errors/doc_generator.rs`\n  - Generate markdown from registry\n  - Per-category documentation\n  - Purpose: Auto-generate docs\n  - _Leverage: ErrorRegistry_\n  - _Requirements: 1.2, 2.3_\n  - _Prompt: Implement the task for spec error-code-registry, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Developer creating generator | Task: Create ErrorDocGenerator for markdown | Restrictions: Per-category, include hints, examples | _Leverage: ErrorRegistry | Success: Docs generate from registry | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n- [ ] 16. Generate initial error documentation\n  - Files: `docs/errors/{index,config,runtime,driver,validation}.md`\n  - Run generator for all categories\n  - Purpose: User-facing error docs\n  - _Leverage: ErrorDocGenerator_\n  - _Requirements: 1.2_\n  - _Prompt: Implement the task for spec error-code-registry, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Technical Writer | Task: Generate error documentation from registry | Restrictions: All categories, searchable format | _Leverage: ErrorDocGenerator | Success: Comprehensive error docs exist | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n- [ ] 17. Add doc generation to build\n  - File: `core/build.rs` or script\n  - Regenerate docs on error changes\n  - Purpose: Keep docs in sync\n  - _Leverage: Build script patterns_\n  - _Requirements: 2.3_\n  - _Prompt: Implement the task for spec error-code-registry, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Build Developer | Task: Add error doc generation to build | Restrictions: Only regenerate on changes, fast | _Leverage: Build scripts | Success: Docs auto-update | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n\n## Phase 6: Testing\n\n- [ ] 18. Add error code tests\n  - File: `core/tests/unit/errors/`\n  - Test formatting, serialization\n  - Verify no duplicate codes\n  - Purpose: Error correctness\n  - _Leverage: Test fixtures_\n  - _Requirements: Non-functional (reliability)_\n  - _Prompt: Implement the task for spec error-code-registry, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Test Developer | Task: Create error code tests | Restrictions: Test formatting, duplicates, serialization | _Leverage: Test fixtures | Success: All error codes valid | After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record artifacts, then mark [x] when complete_\n",
  "fileStats": {
    "size": 13175,
    "lines": 168,
    "lastModified": "2025-12-03T13:33:13.091Z"
  },
  "comments": []
}